<!-- codainvoiceedit -->
<apex:page standardController="c2g__codaInvoice__c" extensions="c2g.CODAHelpLoaderController,c2g.CODAInvoiceController"  contentType="text/html; charset=utf-8" action="{!maximunNumberOfLinesReached}">
    <apex:stylesheet value="{!URLFOR($Resource.c2g__coda2go,'coda2go/web/css/style.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.c2g__front,'front/components/IncomeScheduleCompare/IncomeScheduleCompare.css')}"/>
    <style>
    .pick
	{
        width:173px;
    }
    .clearBtn{border:none;background:none;}
    </style>
    <script src="{!URLFOR($Resource.coda2go,'coda2go/web/script/lib.js')}" type="text/javascript"></script>
    <script src="{!URLFOR($Resource.front,'front/base/frameworks/ext-core-3.1.0.js')}" type="text/javascript"></script>
    <!--locale configuration management -->
    <c:CODALocaleJS />
    <script src="{!URLFOR($Resource.front,'front/components/IncomeScheduleCompare/IncomeScheduleCompare.js')}" type="text/javascript"></script>
	<script>
        CODA.documentFunctionTimer("keyup", CODA.executeQueue, 1500);
        CODA.documentFunctionTimer("click", CODA.executeQueue, 1500);
    </script>
    <script src="{!URLFOR($Resource.coda2go,'coda2go/web/jquery/1.7.1/jquery.min.js')}" type="text/javascript"></script>
    <script src="{!URLFOR($Resource.coda2go,'coda2go/web/jqueryui/1.8.16/jquery-ui.min.js')}" type="text/javascript"></script>
	<script>
		var $FFDC = jQuery.noConflict(),
			isAnalysisReady = true;

		function checkErrorMessage() {
			if ($FFDC('.pbError').length > 0) {
				$FFDC('body,html').scrollTop($FFDC('.pbError').position().top);
			}
		}

                
        $FFDC(function () {
           CODA.prettifySalesforceRunTimeError();
        });
		
		var	CODA2GoButtons = new CODA2GoPage();
		var CODA2GoBtnSaveValue = "{!$Label.codaPageInvoiceEditProcessing2}";
	</script>
    <apex:form onsubmit="if(CODA2GoButtons.disableSaveButtons){ return CODA2GoButtons.disableSaveButtons(); }">

        <apex:actionFunction name="calculateTax" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');  CODA.prettifySalesforceRunTimeError();" reRender="messagePanel,priceBookMessagePanel,taxTotal,invTotal,dtTaxSummary,headerDimensionBlock,lineItemVATDimensionBlock,lineItemSUTDimensionBlock, taxValueSUT"/>

        <DIV id="indicator"><img src="/s.gif" align="absMiddle"/><span id="indicatortext"></span></DIV>
        <!-- Header -->
        <apex:sectionHeader title="{!$Label.c2g__codapageinvoiceviewinvoicedetail}" subtitle="{!viewstate.invoice.dto.Name}{!InvoiceGroupToString}" help="{!redirectForHelp1027}"/>

        <!-- Back to Listing -->
        <DIV class="goBreadcrumb">
        &nbsp;&#171;<a href="{!URLFOR($Action.codaInvoice__c.Tab,$ObjectType.codaInvoice__c)}">{!$Label.codaPageInvoiceEditBackToListInvoices2}</a>
        </DIV>
        <!-- Invoice Detail -->
        <apex:pageBlock title="{!$Label.c2g__codapageinvoiceeditinvoicedetail3}" id="invoiceBlock" mode="edit">
            <!-- Buttons -->
            <apex:pageBlockButtons >
                <!-- Form should have same behaviour on enter as it does when you press save (see 10291), but blur is not triggered when you press enter, so save button must be first submit button, and must call blur before calling the hidden save button. -->
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceeditsave4}" id="save" onclick="document.activeElement.blur();if(!CODA.queing()){document.getElementById('{!$Component.save_h}').click()};return false;" rerender="" />
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceeditsavenew4}" id="save_new" onclick="if(!CODA.queing()){document.getElementById('{!$Component.save_new_h}').click()};return false;" rerender="" rendered="{!$Permission.c2g__SalesInvoiceSave || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c}"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoicenewsavepost}" id="save_post" rerender="" onclick="if(!CODA.queing()){document.getElementById('{!$Component.save_post_h}').click()}return false;" rendered="{!($Permission.c2g__SalesInvoiceSave && $Permission.c2g__SalesInvoicePost) || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c}"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceeditcalculatetax}" id="calculateTax" onclick="if(!CODA.queing()){document.getElementById('{!$Component.calculate_tax_h}').click()};return false;" rendered="{!viewstate.invoice.canCalculateTax && ($Permission.c2g__TaxCodeCalculateTax || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c)}"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceeditcancel3}" id="cancel" rerender="" onclick="if(!CODA.queing()){document.getElementById('{!$Component.cancel_h}').click()};return false;"/>  
                              
                <!-- Hidden Buttons -->               
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceeditsave3}" action="{!save}" id="save_h" styleclass="hiddensubmit"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceeditsavenew3}" action="{!saveAndNew}" id="save_new_h" styleclass="hiddensubmit"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoicenewsavepost}" action="{!saveAndPost}" id="save_post_h" styleclass="hiddensubmit"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceeditcancel3}" action="{!cancel}" id="cancel_h" styleclass="hiddensubmit" immediate="true" reRender=""/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceeditcalculatetax}" action="{!calculateTax}" id="calculate_tax_h" styleclass="hiddensubmit"/>
                <!-- End of Hidden Buttons -->

                <script>
                    CODA2GoButtons.initButtons(["{!$Component.save}","{!$Component.save_new}","{!$Component.save_post}","{!$Component.cancel}","{!$Component.calculateTax}"]);
                </script>
            </apex:pageBlockButtons>
            <!-- Messages -->
            <apex:outputPanel id="warningPagePanel">
            	<apex:pageMessage title="{!$Label.c2g__codaaccounttradingcurnotnull}" severity="warning" strength="2" rendered="{!viewstate.AccountCurrencyWarning}"/>
            </apex:outputPanel>
            <apex:include pageName="c2g__codacompanymismatchwarning"  rendered="{!viewstate.ownerCmpErr}"/>
            <apex:pageMessages id="messagePanel"/>

            <!-- Account Detail -->
            <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceeditaccountdetail2}">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__Account__c.label}" for="account"/>

                    <apex:outputPanel >
                        <apex:outputPanel id="accountPanel">
                            <apex:outputText value="{!viewstate.invoice.accountName}" rendered="{!viewstate.CurrencyLocked}"/>
                            <apex:inputField id="account"
                                value="{!viewstate.invoice.dto.c2g__Account__c}"
                                rendered="{!!viewstate.CurrencyLocked}">
                                <apex:actionSupport event="onblur"
                                    action="{!updateAccountFields}"
                                    onsubmit="CODA.indicatorOn('{!$Label.c2g__codapageinvoicenewretrievingaccountinf}');"
                                    oncomplete="CODA2GoButtons.enableSaveButtons();CODA.indicatorOff();"
                                    reRender="accountPanel,messagePanel,warningPagePanel,priceBookMessagePanel,billingAddress,shippingAddress,currency,suttaxcodes,suttaxcode1panel,suttaxrate1,suttaxcode2panel,suttaxrate2,suttaxcode3panel,suttaxrate3,pricebooksearch,searchProductsField,productsList,netValue,netTotal,taxTotal,invTotal,dtTaxSummary,newLineSUT,newLineVAT,headerDimensionBlock,dueDateOutputPanel"/>
                            </apex:inputField>
                        </apex:outputPanel>
                        <c:AnalysisPopup id="popupHeader" tooltip="{!$Label.c2g__codapageinvoiceedittoggleanalysisarea4}" allowConcurrentPopups="true">
                            <apex:outputPanel id="headerDimensionBlock">
                                <c:SubAnalysis record="{!viewstate.invoice.dto}" title="{!$Label.c2g__codaanalysis}" id="subAnalDimensionBlock" readOnly="false"/>
                            </apex:outputPanel>
                            <!-- CUSTOM FIELDS HEADER -->
                            <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceeditadditionalinformation}" id="headerCustomBlock" collapsible="false" columns="1" rendered="{!viewstate.DynamicFieldsInfoTable.size > 0}">
                                <apex:pageBlockTable id="dtDynamicFields" value="{!viewstate.DynamicFieldsInfoTable}" var="fieldInfo">
                                    <apex:column styleClass="widthauto">
                                        <apex:outputText value="{!fieldInfo.DynamicFieldController.DynamicFieldInfo.label}"/>
                                    </apex:column>
                                    <apex:column styleClass="widthauto">
                                    	<!--
										The implementation using new feature Dynamic Binding in VF would be much easier, efficient and user friendly. We would not need any custom component
										<apex:repeat value="{!myFieldList}" var="f">
											<apex:outputField value="{!account[f]}"/>
										</apex:repeat>
										 -->
                                        <c:CODADynamicField m_fieldinfo="{!fieldInfo.DynamicFieldController.DynamicFieldInfo}" m_mode="EDIT" m_objectc="codaInvoice__c"/>
                                    </apex:column>
                                </apex:pageBlockTable>
                            </apex:pageBlockSection>
                        </c:AnalysisPopup>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!viewstate.isSalesAndUse}"/>

                <!-- Below pageBlockSectionItem rendered depending on Tax Method - Sales and Use Tax -->

                <apex:pageBlockSectionItem rendered="{!viewstate.isSalesAndUse}">
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceedittaxcodes3}"/>

                    <apex:outputPanel id="suttaxcodes">
                        <apex:outputPanel >
                            <apex:outputText value="{!viewstate.invoice.taxCodesAsString}"/>
                        </apex:outputPanel>
                        <c:AnalysisPopup tooltip="{!$Label.c2g__codapageinvoiceedittoggletaxcodesarea4}">
                            <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceedittaxcodes4}" collapsible="false" columns="1">
                                <apex:panelGrid width="100%" columns="3" columnClasses="labelCol first, data2Col first,data2Col">
                                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__TaxCode1__c.label}" for="suttaxcode1"/>
                                    <apex:outputPanel id="suttaxcode1panel">
                                        <apex:inputField id="suttaxcode1" value="{!viewstate.invoice.dto.c2g__TaxCode1__c}" styleClass="popupDataFieldInput"/>
                                        <apex:actionFunction name="onChangeAccTaxCode1" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="suttaxcode1panel,suttaxrate1,suttaxcodes,headerDimensionBlock"/>
                                        <script>
                                            CODA.addQueuedOnBlurEvent(null, "{!$Component.suttaxcode1}", "{!$Label.codaPageInvoiceEditUpdatingTaxRate5}", onChangeAccTaxCode1);
                                        </script>
                                    </apex:outputPanel>
                                    <apex:outputText id="suttaxrate1" value="{!viewstate.invoice.TaxRate1}"/>
                                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__TaxCode2__c.label}" for="suttaxcode2"/>
                                    <apex:outputPanel id="suttaxcode2panel">
                                        <apex:inputField id="suttaxcode2" value="{!viewstate.invoice.dto.c2g__TaxCode2__c}" styleClass="popupDataFieldInput"/>
                                        <apex:actionFunction name="onChangeAccTaxCode2" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="suttaxcode2panel,suttaxrate2,suttaxcodes,headerDimensionBlock"/>
                                        <script>
                                            CODA.addQueuedOnBlurEvent(null, "{!$Component.suttaxcode2}", "{!$Label.codaPageInvoiceEditUpdatingTaxRate6}", onChangeAccTaxCode2);
                                        </script>
                                    </apex:outputPanel>
                                    <apex:outputText id="suttaxrate2" value="{!viewstate.invoice.TaxRate2}"/>
                                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__TaxCode3__c.label}" for="suttaxcode3"/>
                                    <apex:outputPanel id="suttaxcode3panel">
                                        <apex:inputField id="suttaxcode3" value="{!viewstate.invoice.dto.c2g__TaxCode3__c}" styleClass="popupDataFieldInput"/>
                                        <apex:actionFunction name="onChangeAccTaxCode3" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="suttaxcode3panel,suttaxrate3,suttaxcodes,headerDimensionBlock"/>
                                        <script>
                                            CODA.addQueuedOnBlurEvent(null, "{!$Component.suttaxcode3}", "{!$Label.codaPageInvoiceEditUpdatingTaxRate7}", onChangeAccTaxCode3);
                                        </script>
                                    </apex:outputPanel>
                                    <apex:outputText id="suttaxrate3" value="{!viewstate.invoice.TaxRate3}"/>
                                </apex:panelGrid>
                            </apex:pageBlockSection>
                        </c:AnalysisPopup>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__Opportunity__c.label}"/>
                    <apex:outputField value="{!viewstate.invoice.dto.c2g__Opportunity__c}"/>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceeditbillingaddress2}"/>
                    <apex:outputText id="billingAddress" value="{!viewstate.invoice.billingAddress.fullAddress}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceeditshippingaddress2}"/>
                    <apex:outputText id="shippingAddress" value="{!viewstate.invoice.shippingAddress.fullAddress}"/>
                </apex:pageBlockSectionItem>

            </apex:pageBlockSection>
       
            <!-- Invoice Detail -->
            <apex:pageBlockSection id="invoiceDetail" title="{!$Label.c2g__codapageinvoiceeditinvoicedetail4}">
                <apex:outputField id="invGroup" value="{!viewstate.invoice.dto.c2g__InvoiceGroup__c}"/>
                <apex:inputCheckbox id="generateAdjustmentJournal" value="{!viewstate.invoice.dto.c2g__GenerateAdjustmentJournal__c}"/>

                <apex:outputField value="{!viewstate.invoice.dto.Name}"/>

                <apex:inputField value="{!viewstate.invoice.dto.c2g__CustomerReference__c}"/>

                <apex:pageBlockSectionItem >
                <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__InvoiceDate__c.label}" for="invoiceDate"/>
                <apex:outputPanel >
                    <apex:inputField id="invoiceDate" value="{!viewstate.invoice.dto.c2g__InvoiceDate__c}"/>
                    <apex:actionFunction name="onChangeInvoiceDate" action="{!updateInvoiceDate}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');incomeScheduleCompare.constructor();" reRender="messagePanel,warningPagePanel,priceBookMessagePanel,dtLineItemsSUT,dtLineItemsVAT,netTotal,taxTotal,invTotal,dtTaxSummary,suttaxrate1,suttaxrate2,suttaxrate3,headerDimensionBlock,lineItemVATDimensionBlock,lineItemSUTDimensionBlock,dueDateOutputPanel,periodValue,invoiceDetail,invoiceScheduleOutputPanel,incomeScheduleOutputPanel,paymentScheduleOutputPanel"/>
                    <script>
                        CODA.addToFocusEvent("{!$Component.invoiceDate}");
                        CODA.addQueuedOnBlurEvent(null, "{!$Component.invoiceDate}", "{!$Label.codaPageInvoiceEditUpdatingTaxRate8}", onChangeInvoiceDate, true);
                    </script>
                </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:inputField value="{!viewstate.invoice.dto.c2g__Period__c}" id="periodValue"/>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__DueDate__c.label}" for="dueDate"/>
                    <apex:outputPanel id="dueDateOutputPanel">
                        <apex:inputField id="dueDate" value="{!viewstate.invoice.dto.c2g__DueDate__c}" required="{!!viewstate.showPaymentSchedule}" rendered="{!!viewstate.showPaymentSchedule}"/>
                        <script>
                            CODA.addToFocusEvent("{!$Component.dueDate}");
                        </script>
                        <apex:outputText id="paymentScheduleDueDate" value="{!$Label.c2g__codapageinvoiceeditpaymentschedule2}" rendered="{!viewstate.showPaymentSchedule}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:inputField value="{!viewstate.invoice.dto.c2g__ShippingMethod__c}"/>

                <apex:pageBlockSectionItem id="currencyblock">
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceeditinvoicecurrency2}" for="selectCur"/>

                    <apex:outputPanel id="currency" layout="block" styleClass="currencyHolder">
                        <DIV id="currencyValueArea" style="display:block;">
                            <apex:outputText id="currencyvalue" value="{!viewstate.invoice.Currency}"/>
                            <c:ExchangeRateOverrides id="currencyRates" rateData="{!viewstate.invoice.exchangeRateData}" readOnly="false"/>
                        </DIV>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:inputField value="{!viewstate.invoice.dto.c2g__InvoiceDescription__c}" styleClass="largeTextArea"/>

            </apex:pageBlockSection>
            <!-- Invoice Line Items -->
	        <apex:actionFunction name="onChangeProduct"  action="{!viewstate.updateProductItem}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');CODA.setFocusOnLookUp('{!$Component.invoiceBlock.lineItemSection.dtLineItemsSUT.productSUT}');incomeScheduleCompare.constructor();" reRender="messagePanel,priceBookMessagePanel,productPanelSUT,taxValueSUT,netValueSUT,netTotal,taxTotal,invTotal,dtTaxSummary,accountPanel,currency,unitPriceSUTPanel,taxCompositePanelSUT,newLineSUT,dtLineItemsSUT,headerDimensionBlock,invoiceScheduleOutputPanel,incomeScheduleOutputPanel,paymentScheduleOutputPanel, taxCodeCombinedPanel">
			   	<apex:param name="updateProductItemIndex" assignTo="{!viewstate.updateProductItemIndex}" value="" />
			</apex:actionFunction>
			<apex:actionFunction name="onChangeLine" action="{!viewstate.updateTaxValueItem}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');incomeScheduleCompare.constructor();" reRender="messagePanel,priceBookMessagePanel,taxValueSUT,taxTotal,netValueSUT,netTotal,invTotal,dtTaxSummary,taxValue1Panel,taxValue2Panel,taxValue3SUT,headerDimensionBlock,lineItemSUTDimensionBlock,invoiceScheduleOutputPanel,incomeScheduleOutputPanel,invoiceBlock,taxCodeCombined">
			 	<apex:param name="updateTaxValueItemIndex" assignTo="{!viewstate.updateTaxValueItemIndex}" value="" />
			</apex:actionFunction>                        
			<apex:actionFunction name="onChangeTaxCode1" action="{!viewstate.updateTaxCode1Item}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="messagePanel,priceBookMessagePanel,taxCode1PanelSUT,taxRate1PanelSUT,taxValueSUT,taxCompositeSUT,taxTotal,invTotal,dtTaxSummary,taxRate1PanelSUT,taxTotal,headerDimensionBlock,lineItemSUTDimensionBlock, taxValue1Panel">
			 	<apex:param name="updateTaxCode1ItemIndex" assignTo="{!viewstate.updateTaxCode1ItemIndex}" value="" />
			</apex:actionFunction>                        
			<apex:actionFunction name="onChangeTaxRate1" action="{!viewstate.updateTaxRate1Item}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="messagePanel,priceBookMessagePanel,taxValueSUT,taxCompositeSUT,invTotal,dtTaxSummary,taxValue1SUT,taxValue1Panel,taxTotal,headerDimensionBlock,lineItemSUTDimensionBlock">
			 	<apex:param name="updateTaxRate1ItemIndex" assignTo="{!viewstate.updateTaxRate1ItemIndex}" value="" />
			</apex:actionFunction>
			<apex:actionFunction name="onChangeTaxCode2" action="{!viewstate.updateTaxCode2Item}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="messagePanel,priceBookMessagePanel,taxCode2PanelSUT,taxRate2PanelSUT,taxValueSUT,taxCompositeSUT,taxTotal,invTotal,dtTaxSummary,taxRate2PanelSUT,taxTotal,headerDimensionBlock,lineItemSUTDimensionBlock, taxValue2Panel">
			 	<apex:param name="updateTaxCode2ItemIndex" assignTo="{!viewstate.updateTaxCode2ItemIndex}" value="" />
			</apex:actionFunction>
			<apex:actionFunction name="onChangeTaxRate2" action="{!viewstate.updateTaxRate2Item}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="messagePanel,priceBookMessagePanel,taxValueSUT,taxCompositeSUT,taxTotal,invTotal,dtTaxSummary,taxValue2SUT,taxValue2Panel,taxTotal,headerDimensionBlock,lineItemSUTDimensionBlock">
			 	<apex:param name="updateTaxRate2ItemIndex" assignTo="{!viewstate.updateTaxRate2ItemIndex}" value="" />
			</apex:actionFunction>
			<apex:actionFunction name="onChangeTaxCode3" action="{!viewstate.updateTaxCode3Item}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="messagePanel,priceBookMessagePanel,taxCode3PanelSUT,taxRate3PanelSUT,taxValue3PanelSUT,taxValueSUT,taxCompositeSUT,invTotal,dtTaxSummary,taxValue3SUT,taxRate3PanelSUT,taxTotal,headerDimensionBlock,lineItemSUTDimensionBlock">
			 	<apex:param name="updateTaxCode3ItemIndex" assignTo="{!viewstate.updateTaxCode3ItemIndex}" value="" />
			</apex:actionFunction>
			<apex:actionFunction name="onChangeTaxRate3" action="{!viewstate.updateTaxRate3Item}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="messagePanel,priceBookMessagePanel,taxValueSUT,taxCompositeSUT,invTotal,dtTaxSummary,taxValue3SUT,taxValue3PanelSUT,taxTotal,headerDimensionBlock,lineItemSUTDimensionBlock">
			 	<apex:param name="updateTaxRate3ItemIndex" assignTo="{!viewstate.updateTaxRate3ItemIndex}" value="" />
			</apex:actionFunction>
			<apex:actionFunction name="onChangeIncomeScheduleSUT" action="{!viewstate.updateIncomeScheduleItem}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');incomeScheduleCompare.constructor();" reRender="messagePanel,priceBookMessagePanel,dtLineItemsSUT,incomeScheduleSUT,incomeScheduleButtonSUT,invoiceScheduleOutputPanel,incomeScheduleOutputPanel,paymentScheduleOutputPanel">
			 	<apex:param name="updateIncomeScheduleItemIndex" assignTo="{!viewstate.updateIncomeScheduleItemIndex}" value="" />
			</apex:actionFunction>
			<apex:actionFunction name="removeLineItem"  action="{!viewstate.removeItem}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');incomeScheduleCompare.constructor();" reRender="messagePanel,priceBookMessagePanel,dtLineItemsSUT,netTotal,taxTotal,invTotal,dtTaxSummary,currency,accountPanel,newLineSUT,invoiceScheduleOutputPanel,incomeScheduleOutputPanel,paymentScheduleOutputPanel">
                <apex:param name="lineItemSequenceNo" assignTo="{!viewstate.lineItemSequenceNo}" value="" />
            </apex:actionFunction> 
	        <apex:actionFunction name="onChangeProductVAT" action="{!viewstate.updateProductItem}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');CODA.setFocusOnLookUp('{!$Component.invoiceBlock.lineItemSection.dtLineItemsVAT.productVAT}');incomeScheduleCompare.constructor();" reRender="messagePanel,priceBookMessagePanel,productPanelVAT,taxCodePanelVAT,taxPanelValueVAT,netValueVAT,taxTotal,invTotal,netTotal,dtTaxSummary,accountPanel,currency,unitPriceVATPanel,newLineVAT,dtLineItemsVAT,headerDimensionBlock,invoiceScheduleOutputPanel,incomeScheduleOutputPanel,paymentScheduleOutputPanel">
	         	<apex:param name="updateProductItemIndex" assignTo="{!viewstate.updateProductItemIndex}" value="" />
			</apex:actionFunction>                               
	        <apex:actionFunction name="onChangeLineVAT" action="{!viewstate.updateTaxValueItem}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');incomeScheduleCompare.constructor();" reRender="messagePanel,priceBookMessagePanel,taxPanelValueVAT,taxTotal,netValueVAT,netTotal,invTotal,dtTaxSummary,headerDimensionBlock,lineItemVATDimensionBlock,invoiceScheduleOutputPanel,incomeScheduleOutputPanel,invoiceBlock">
	         	<apex:param name="updateTaxValueItemIndex" assignTo="{!viewstate.updateTaxValueItemIndex}" value="" />
			</apex:actionFunction>                               
	        <apex:actionFunction name="onChangeTaxCodeVAT" action="{!viewstate.updateTaxCode1Item}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="messagePanel,priceBookMessagePanel,taxCodePanelVAT,taxPanelValueVAT,taxTotal,invTotal,dtTaxSummary,headerDimensionBlock,lineItemVATDimensionBlock">
	         	<apex:param name="updateTaxCode1ItemIndex" assignTo="{!viewstate.updateTaxCode1ItemIndex}" value="" />
			</apex:actionFunction>                               
	        <apex:actionFunction name="onChangeIncomeScheduleVAT" action="{!viewstate.updateIncomeScheduleItem}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');incomeScheduleCompare.constructor();" reRender="messagePanel,priceBookMessagePanel,dtLineItemsVAT,incomeScheduleVAT,incomeScheduleButton,invoiceScheduleOutputPanel,incomeScheduleOutputPanel,paymentScheduleOutputPanel">
	         	<apex:param name="updateIncomeScheduleItemIndex" assignTo="{!viewstate.updateIncomeScheduleItemIndex}" value="" />
			</apex:actionFunction>                               
	        <apex:actionFunction name="removeLineItemVAT"  action="{!viewstate.removeItem}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');incomeScheduleCompare.constructor();" reRender="messagePanel,priceBookMessagePanel,dtLineItemsVAT,dtLineItemsSUT,netTotal,taxTotal,invTotal,dtTaxSummary,currency,accountPanel,newLineVAT,invoiceScheduleOutputPanel,incomeScheduleOutputPanel,paymentScheduleOutputPanel">
                <apex:param name="lineItemSequenceNo" assignTo="{!viewstate.lineItemSequenceNo}" value="" />
            </apex:actionFunction> 
            <apex:actionFunction name="removeInstallmentLineItem" action="{!viewstate.removeInstallmentLineItem}" oncomplete="CODA.resumeQueueProcessing();" reRender="messagePanel,priceBookMessagePanel,paymentScheduleFieldsOutputPanel">
               	<apex:param name="installmentLineItemSequenceNo" assignTo="{!viewstate.installmentLineItemSequenceNo}" value="" />
            </apex:actionFunction>
    		<apex:actionFunction name="addSearchLine" action="{!viewstate.addSearchLineItem}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="messagePanel,priceBookMessagePanel,currency,dtLineItemsSUT,dtLineItemsVAT,netTotal,taxTotal,invTotal,dtTaxSummary,accountPanel,headerDimensionBlock,lineItemVATDimensionBlock,lineItemSUTDimensionBlock,invoiceScheduleOutputPanel,incomeScheduleOutputPanel">
			 	<apex:param name="addSearchLineItemIndex" assignTo="{!viewstate.addSearchLineItemIndex}" value="" />
            </apex:actionFunction>
            <apex:actionFunction name="onChangeTaxCodeCombined" action="{!viewstate.updateTaxCodeCombinedItem}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="messagePanel,priceBookMessagePanel,taxCode1PanelSUT,taxRate1PanelSUT, taxCode2PanelSUT,taxRate2PanelSUT,taxValueSUT,taxCompositeSUT,taxTotal,invTotal,dtTaxSummary,taxValue1Panel, taxValue2Panel, taxTotal,headerDimensionBlock,lineItemSUTDimensionBlock">
                <apex:param name="updateTaxCodeCombinedItemIndex" assignTo="{!viewstate.updateTaxCodeCombinedItemIndex}" value="" />
           </apex:actionFunction>
           <apex:actionfunction name="reloadAlternateAccount" action="{!populateAlternateAccountOnDimensionsChange}" oncomplete="CODA2GoButtons.enableSaveButtons();CODA.resumeQueueProcessing();CODA.indicatorOff();" rerender="alternateAccountGlaPanelVAT,alternateAccountLocalGlaPanelVAT,alternateAccountGlaPanelSUT,alternateAccountLocalGlaPanelSUT">
		       <apex:param name="lineNumber" value=""/>
		   </apex:actionfunction>
		   <apex:actionFunction name="onChangeGLA" action="{!viewstate.processGLAChanged}" rerender="analysisInfoSUT,analysisInfoVAT,messagePanel" oncomplete="CODA2GoButtons.enableSaveButtons(); CODA.indicatorOff();">
			   <apex:param name="lineIndex" value=""/>
		   </apex:actionFunction>

           <!-- Invoice Line Items -->                                                  
            <apex:pageBlockSection id="lineItemSection" title="{!$Label.c2g__codapageinvoiceeditinvoicelineitems2}" columns="1">
                <apex:pageBlockTable id="dtLineItemsSUT" styleClass="noHover" rendered="{!viewstate.useMultipleTaxCodes}" value="{!viewstate.invoice.lineItems}" var="lineItemSUT">

                    <apex:column styleClass="widthlinenumbers">
                        <apex:facet name="header">&nbsp;</apex:facet>
                        <apex:outputPanel id="analysisInfoSUT">
                            <span style="white-space: nowrap" onclick="if(!isAnalysisReady) return false;">
                                <apex:outputField value="{!lineItemSUT.dto.c2g__LineNumber__c}"/>
                                <c:AnalysisPopup id="popupLineSut" tooltip="{!$Label.c2g__codapageinvoiceedittogglenotesandanaly2}">
                                	<apex:pageBlockSection title="{!$Label.c2g__alternateaccount}" collapsible="false" columns="1" html-sac="1" rendered="{!allowLocalGLA && viewstate.EnableOverrideProductGLA}">
								        <apex:pageBlockSectionItem html-sac="1" rendered="{!showLocalGLA}">	
								        	<apex:outputLabel value="{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__GeneralLedgerAccount__c.label}" styleClass="fieldLabel"/>
								        	<apex:outputPanel id="alternateAccountGlaPanelSUT">
												<span class="popupDataFieldOutput">
													<apex:outputField value="{!lineItemSUT.dto.c2g__GeneralLedgerAccount__c}"/>
												</span>
											</apex:outputPanel>	
								        </apex:pageBlockSectionItem>
								        <apex:pageBlockSectionItem html-sac="1" rendered="{!allowLocalGLA && !showLocalGLA}">	
                                            <apex:outputLabel value="{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__LocalGLA__c.label}" styleClass="fieldLabel"/>
								        	<apex:outputPanel id="alternateAccountLocalGlaPanelSUT">
												<span class="popupDataFieldOutput">
                                                    <apex:outputField value="{!lineItemSUT.dto.c2g__LocalGLA__c}"/>
												</span>
											</apex:outputPanel>	
								        </apex:pageBlockSectionItem>
									</apex:pageBlockSection>
                                    <apex:outputPanel layout="block" styleClass="headerdetails">
                                    	<apex:outputPanel id="lineItemSUTDimensionBlock">
                                    		<c:SubAnalysis record="{!lineItemSUT.dto}" onChangeDimensions="if(!isAnalysisReady) return false;CODA.indicatorOn('{!$Label.c2g__chartofaccountsmappingsretrieving}');reloadAlternateAccount('{!lineItemSUT.dto.c2g__LineNumber__c}');" title="{!$Label.c2g__codanotesandanalysis}" readOnly="false" intercompany-detail="true" lineNumber="{!lineItemSUT.LineNumber}" rendered="{!allowLocalGLA && viewstate.EnableOverrideProductGLA}"/>
                                       		<c:SubAnalysis record="{!lineItemSUT.dto}" title="{!$Label.c2g__codanotesandanalysis}" readOnly="false" intercompany-detail="true" lineNumber="{!lineItemSUT.LineNumber}" rendered="{!OR(!allowLocalGLA, !viewstate.EnableOverrideProductGLA)}"/>
                                    	</apex:outputPanel>
                                        <!-- CUSTOM FIELDS LINE ITEM SUT -->
                                        <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceeditadditionalinformation}" id="customFieldBlock" collapsible="false" columns="2" rendered="{!lineItemSUT.DynamicFieldsInfoTableLI.size > 0}">
                                            <apex:pageBlockTable id="dtDynamicFieldLineItemsSUT" value="{!lineItemSUT.DynamicFieldsInfoTableLI}" var="fieldSUT">
                                                <apex:column styleClass="widthauto">
                                                    <apex:outputText value="{!fieldSUT.DynamicFieldController.dynamicFieldInfo.label}"/>
                                                </apex:column>
                                                <apex:column styleClass="widthauto">
                                                	<!--
        											The implementation using new feature Dynamic Binding in VF would be much easier, efficient and user friendly. We would not need any custom component
        											<apex:repeat value="{!myFieldList}" var="f">
        												<apex:outputField value="{!account[f]}"/>
        											</apex:repeat>
        											 -->
                                                    <c:CODADynamicField m_fieldinfo="{!fieldSUT.DynamicFieldController.DynamicFieldInfo}" m_mode="EDIT" m_objectc="codaInvoiceLineItem__c"/>
                                                </apex:column>
                                            </apex:pageBlockTable>
                                        </apex:pageBlockSection>
                                    </apex:outputPanel>
                                </c:AnalysisPopup>
                            </span>
                        </apex:outputPanel>
                    </apex:column>

                    <apex:column styleClass="widthauto">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__Product__c.label}</apex:facet>
                        <apex:outputPanel id="productPanelSUT">
                            <apex:inputField id="productSUT" value="{!lineItemSUT.dto.c2g__Product__c}"/>
                            <script>
                                CODA.addQueuedOnBlurEventWithParam(null, "{!$Component.productSUT}", "{!$Label.codaPageInvoiceEditCalculatingTax11}", onChangeProduct, {!lineItemSUT.LineNumber-1}, true);
                            </script>
                        </apex:outputPanel>
                    </apex:column>

                    <apex:column styleClass="widthauto" rendered="{!!showLocalGLA && viewstate.EnableOverrideProductGLA}">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__GeneralLedgerAccount__c.label}</apex:facet>
                    	<apex:inputField id="overrideGLASUT" value="{!lineItemSUT.dto.c2g__GeneralLedgerAccount__c}" onChange="CODA.indicatorOn('{!$Label.c2g__chartofaccountsmappingsretrieving}'); onChangeGLA({!lineItemSUT.dto.c2g__LineNumber__c - 1})" rendered="{!allowLocalGLA}"/>
                        <apex:inputField id="overrideGLASUTNonLocal" value="{!lineItemSUT.dto.c2g__GeneralLedgerAccount__c}" rendered="{!!allowLocalGLA}"/>
                    </apex:column>
                    
                    <apex:column styleClass="widthauto" rendered="{!showLocalGLA && viewstate.EnableOverrideProductGLA}">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__LocalGLA__c.label}</apex:facet>
						<c:LookupPicklist styleClass="pick" sObjectFieldType="codaInvoiceLineItem__c.LocalGLA__c" onChange="CODA.indicatorOn('{!$Label.c2g__chartofaccountsmappingsretrieving}'); onChangeGLA({!lineItemSUT.dto.c2g__LineNumber__c - 1})" recentItems="3" lookupValue="{!lineItemSUT.dto.c2g__LocalGLA__c}" LabelFormatting="{Name} - {ReportingCode__c}"/>
					</apex:column>

                    <apex:column styleClass="widthsmall" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__Quantity__c.label}</apex:facet>
                        <apex:inputText id="quantitySUT" disabled="{!!lineItemSUT.isProductSet}" value="{!lineItemSUT.Quantity}" required="false" styleClass="alignright"/>
                        <script>
                            CODA.addQueuedOnBlurEventWithParam("onChangeLine{!lineItemSUT.LineNumber}", "{!$Component.quantitySUT}", "{!$Label.codaPageInvoiceEditCalculatingLine5}", onChangeLine, {!lineItemSUT.LineNumber-1});
                        </script>
                        <apex:message for="quantitySUT" styleClass="errorMsg"/>
                    </apex:column>

                    <apex:column styleClass="widthmedium" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__UnitPrice__c.label}</apex:facet>
                        <apex:outputPanel id="unitPriceSUTPanel">
                            <apex:inputText id="unitPriceSUT" disabled="{!!lineItemSUT.isProductSet}" value="{!lineItemSUT.UnitPrice}" required="false" styleClass="alignright"/>
                            <script>
                                CODA.addQueuedOnBlurEventWithParam("onChangeLine{!lineItemSUT.LineNumber}", "{!$Component.unitPriceSUT}", "{!$Label.codaPageInvoiceEditCalculatingLine6}", onChangeLine, {!lineItemSUT.LineNumber-1});
                            </script>
                            <apex:message for="unitPriceSUT" styleClass="errorMsg"/>
                        </apex:outputPanel>
                    </apex:column>

                    <apex:column styleClass="widthauto" rendered="{!viewstate.isCombinedTax}">
                        <apex:facet name="header">
                            <apex:outputPanel layout="block">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxCodeCombined__c.label}</apex:outputPanel>
                        </apex:facet>
                        <apex:outputPanel id="taxCodeCombinedPanel">
                            <apex:inputField id="taxCodeCombined" rendered="{!lineItemSUT.isProductSet}" value="{!lineItemSUT.dto.c2g__TaxCodeCombined__c}" required="false"/>
                            <script>
                                CODA.addQueuedOnBlurEventWithParam(null, "{!$Component.taxCodeCombined}", "{!$Label.codaPageInvoiceEditCalculatingTax12}", onChangeTaxCodeCombined, {!lineItemSUT.LineNumber-1});
                            </script>
                            <apex:message for="taxCodeCombined" styleClass="errorMsg"/>
                        </apex:outputPanel>
                    </apex:column>
					
                    <apex:column styleClass="widthsmall alignright" headerClass="alignright">
                        <apex:facet name="header">Tax Rate</apex:facet>
                        <apex:outputPanel id="taxCompositePanelSUT">
                            <apex:outputPanel style="white-space: nowrap">
                                <apex:outputText id="taxCompositeSUT" value="{!lineItemSUT.CompositeTaxRate}"/>
                                <c:AnalysisPopup tooltip="{!$Label.c2g__codapageinvoiceedittoggletaxratesarea}">                           
                                    <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceedittaxrates2}" collapsible="false" columns="1">
                                        <apex:panelGrid columns="4" columnClasses="taxRatesLabel widthauto, widthauto, widthauto alignright, widthmedium alignright">
                                                <apex:outputText value=" "/>
                                                <apex:outputText value=" "/>
                                                <apex:outputLabel value="{!$Label.c2g__codapageinvoiceedittaxrate2}" styleClass="taxRatesLabel"/>
                                                <apex:outputLabel value="{!$Label.c2g__codapageinvoiceedittaxvalue2}" styleClass="taxRatesLabel"/>

                                                <apex:outputLabel value="{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxCode1__c.label}" for="taxCode1SUT" styleclass="paddtop"/>
                                                <apex:outputPanel id="taxCode1PanelSUT">
                                                    <apex:inputField id="taxCode1SUT" value="{!lineItemSUT.dto.c2g__TaxCode1__c}" styleClass="popupDataFieldInput"/>
                                                    <script>
                                                        CODA.addQueuedOnBlurEventWithParam(null, "{!$Component.taxCode1SUT}", "{!$Label.codaPageInvoiceEditCalculatingTax12}", onChangeTaxCode1, {!lineItemSUT.LineNumber-1});
                                                    </script>
                                                </apex:outputPanel>
                                                <apex:outputPanel id="taxRate1PanelSUT">
                                                    <apex:inputField id="taxRate1SUT" value="{!lineItemSUT.dto.c2g__TaxRate1__c}" styleclass="alignright" rendered="{!viewstate.isSalesAndUse}"/>

                                                    <script>
                                                        CODA.addQueuedOnBlurEventWithParam(null, "{!$Component.taxRate1SUT}", "{!$Label.codaPageInvoiceEditCalculatingTax13}", onChangeTaxRate1, {!lineItemSUT.LineNumber-1});
                                                    </script>
                                                    <apex:outputField id="taxRate1Combined" value="{!lineItemSUT.dto.c2g__TaxRate1__c}" styleclass="alignright" rendered="{!viewstate.isCombinedTax}"/>
                                                </apex:outputPanel>
                                                <apex:outputPanel id="taxValue1Panel">
                                                    <apex:outputText id="taxValue1SUT" value="{!lineItemSUT.TaxValue1WithSymbol}" rendered="{!viewstate.isSalesAndUse && !viewstate.isAllowOverrideOfTaxValues}"/>
                                                    <apex:inputText id="taxValue1SUTEdit" value="{!lineItemSUT.TaxValue1}" rendered="{!viewstate.isSalesAndUse && viewstate.isAllowOverrideOfTaxValues}" styleclass="alignright"/>
                                                    <apex:inputText id="taxValue1Combined" value="{!lineItemSUT.TaxValue1}" rendered="{!viewstate.isCombinedTax}" styleclass="alignright"/>
                                                    <script>
                                                    CODA.addQueuedOnBlurEvent("calculateTax", "{!$Component.taxValue1Combined}", "{!$Label.codaPageInvoiceNewCalculatingTax10}", calculateTax);
                                                    CODA.addQueuedOnBlurEvent("calculateTax", "{!$Component.taxValue1SUTEdit}", "{!$Label.codaPageInvoiceNewCalculatingTax10}", calculateTax);
                                                    </script>
                                                </apex:outputPanel>

                                                <apex:outputLabel value="{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxCode2__c.label}" for="taxCode2SUT" styleclass="paddtop"/>
                                                <apex:outputPanel id="taxCode2PanelSUT">
                                                    <apex:inputField id="taxCode2SUT" value="{!lineItemSUT.dto.c2g__TaxCode2__c}" styleClass="popupDataFieldInput"/>
                                                    <script>
                                                        CODA.addQueuedOnBlurEventWithParam(null, "{!$Component.taxCode2SUT}", "{!$Label.codaPageInvoiceEditCalculatingTax14}", onChangeTaxCode2, {!lineItemSUT.LineNumber-1});
                                                    </script>
                                                </apex:outputPanel>
                                                <apex:outputPanel id="taxRate2PanelSUT">
                                                    <apex:inputField id="taxRate2SUT" value="{!lineItemSUT.dto.c2g__TaxRate2__c}" styleclass="alignright" rendered="{!viewstate.isSalesAndUse}"/>
                                                    <script>
                                                        CODA.addQueuedOnBlurEventWithParam(null, "{!$Component.taxRate2SUT}", "{!$Label.codaPageInvoiceEditCalculatingTax15}", onChangeTaxRate2, {!lineItemSUT.LineNumber-1});
                                                    </script>
                                                    <apex:outputField id="taxRate2Combined" value="{!lineItemSUT.dto.c2g__TaxRate2__c}" styleclass="alignright" rendered="{!viewstate.isCombinedTax}"/>
                                                </apex:outputPanel>
                                                <apex:outputPanel id="taxValue2Panel">
                                                    <apex:outputText id="taxValue2SUT" value="{!lineItemSUT.TaxValue2WithSymbol}" rendered="{!viewstate.isSalesAndUse && !viewstate.isAllowOverrideOfTaxValues}"/>
                                                    <apex:inputText id="taxValue2SUTEdit" value="{!lineItemSUT.TaxValue2}" rendered="{!viewstate.isSalesAndUse && viewstate.isAllowOverrideOfTaxValues}" styleclass="alignright"/>
                                                    <apex:inputText id="taxValue2Combined" value="{!lineItemSUT.TaxValue2}" rendered="{!viewstate.isCombinedTax}" styleclass="alignright"/>
                                                    <script>
                                                    CODA.addQueuedOnBlurEvent("calculateTax", "{!$Component.taxValue2Combined}", "{!$Label.codaPageInvoiceNewCalculatingTax10}", calculateTax);
                                                    CODA.addQueuedOnBlurEvent("calculateTax", "{!$Component.taxValue2SUTEdit}", "{!$Label.codaPageInvoiceNewCalculatingTax10}", calculateTax);
                                                    </script>
                                                </apex:outputPanel>

                                                <apex:outputLabel value="{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxCode3__c.label}" for="taxCode3SUT" styleclass="paddtop" rendered="{!viewstate.isSalesAndUse}"/>
                                                <apex:outputPanel id="taxCode3PanelSUT" rendered="{!viewstate.isSalesAndUse}">
                                                    <apex:inputField id="taxCode3SUT" value="{!lineItemSUT.dto.c2g__TaxCode3__c}" styleClass="popupDataFieldInput" rendered="{!viewstate.isSalesAndUse}"/>
                                                    <script>
                                                        CODA.addQueuedOnBlurEventWithParam(null, "{!$Component.taxCode3SUT}", "{!$Label.codaPageInvoiceEditCalculatingTax16}", onChangeTaxCode3, {!lineItemSUT.LineNumber-1});
                                                    </script>
                                                </apex:outputPanel>
                                                <apex:outputPanel id="taxRate3PanelSUT" rendered="{!viewstate.isSalesAndUse}">
                                                    <apex:inputField id="taxRate3SUT" value="{!lineItemSUT.dto.c2g__TaxRate3__c}" styleclass="alignright"/>
                                                    <script>
                                                        CODA.addQueuedOnBlurEventWithParam(null, "{!$Component.taxRate3SUT}", "{!$Label.codaPageInvoiceEditCalculatingTax17}", onChangeTaxRate3, {!lineItemSUT.LineNumber-1});
                                                    </script>
                                                </apex:outputPanel>
                                                <apex:outputPanel id="taxValue3PanelSUT" rendered="{!viewstate.isSalesAndUse}">
                                                    <apex:outputText id="taxValue3SUT" value="{!lineItemSUT.TaxValue3WithSymbol}" rendered="{!!viewstate.isAllowOverrideOfTaxValues}"/>
                                                    <apex:inputText id="taxValue3SUTEdit" value="{!lineItemSUT.TaxValue3}" rendered="{!viewstate.isAllowOverrideOfTaxValues}" styleclass="alignright"/>
	                                                <script>
	                                                    CODA.addQueuedOnBlurEvent("calculateTax", "{!$Component.taxValue3SUTEdit}", "{!$Label.codaPageInvoiceNewCalculatingTax10}", calculateTax);
	                                                </script>
	                                            </apex:outputPanel>
                                        </apex:panelGrid>
                                    </apex:pageBlockSection>
                                </c:AnalysisPopup>
                            </apex:outputPanel>
                        </apex:outputPanel>
                    </apex:column>

                    <apex:column styleClass="widthmedium alignright" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxValue1__c.label}</apex:facet>
                        <apex:outputText id="taxValueSUT" value="{!lineItemSUT.TaxValueTotalWithSymbol}" styleClass="alignright" />
                    </apex:column>
                    <apex:column styleClass="widthmedium alignright" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__NetValue__c.label}</apex:facet>
                        <apex:outputText id="netValueSUT" value="{!lineItemSUT.NetValue}"/>
                    </apex:column>
                    <apex:column styleClass="widthmedium alignright" headerClass="alignleft">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__IncomeSchedule__c.label}</apex:facet>
                        <apex:inputField id="incomeScheduleSUT" value="{!lineItemSUT.dto.c2g__IncomeSchedule__c}"/>
                        <script>
                            CODA.addQueuedOnBlurEventWithParam(null, "{!$Component.incomeScheduleSUT}", "{!$Label.codaInvoiceIncomeScheduleUpdatingIncomeScheduleEdit}", onChangeIncomeScheduleSUT, {!lineItemSUT.LineNumber-1},true);
                        </script>
                    </apex:column>
                    <apex:column styleClass="widthsmall aligncenter" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__IncomeScheduleGroup__c.label}</apex:facet>
                        <apex:outputField id="incomeScheduleGroup" value="{!lineItemSUT.dto.c2g__IncomeScheduleGroup__c}"/>
                    </apex:column>
                    <apex:column styleClass="widthicon alignright">
                        <apex:facet name="header">&nbsp;</apex:facet>
                        <apex:commandButton id="incomeScheduleButtonSUT" title="{!$Label.c2g__codainvoiceincomeschedulescheduleinformationedit}" image="{!URLFOR($Resource.c2g__coda2go, 'coda2go/web/images/FinancialForceScheduleInformationIcon.png')}" action="{!lineItemSUT.scheduleInformation}" rendered="{!lineItemSUT.ScheduleInformationButtonStatus}" styleClass="incomeScheduleButton"/>
                    </apex:column>
                    <apex:column styleClass="widthicon alignright" headerClass="pageBlockTableNoLabelHeader">
                        <apex:facet name="header">&nbsp;</apex:facet>
                        
                        <a href="javascript:CODA.addEventToQueueWithParam('removeLineItem{!lineItemSUT.LineNumber}', removeLineItem, {!lineItemSUT.SequenceNo}, '{!$Label.codaPageInvoiceEditRemovingLine3}', true);" class="deleteIcon">
                        </a>
                    </apex:column>
                </apex:pageBlockTable>

                <apex:pageBlockTable id="dtLineItemsVAT" styleClass="noHover" rendered="{!viewstate.isVat}" value="{!viewstate.invoice.lineItems}" var="lineItemVAT">

                    <apex:column styleClass="widthlinenumbers">
                        <apex:facet name="header">&nbsp;</apex:facet>
                        <apex:outputPanel id="analysisInfoVAT">
                            <span style="white-space: nowrap" onclick="if(!isAnalysisReady) return false;">
                                <apex:outputField value="{!lineItemVAT.dto.c2g__LineNumber__c}"/>
                                <c:AnalysisPopup id="popupLineVat" tooltip="{!$Label.c2g__codapageinvoiceedittogglenotesandanaly3}">
                                    <apex:outputPanel layout="block" styleClass="headerdetails">
                                   	<apex:pageBlockSection title="{!$Label.c2g__alternateaccount}" collapsible="false" columns="1" html-sac="1" rendered="{!allowLocalGLA && viewstate.EnableOverrideProductGLA}">
								        <apex:pageBlockSectionItem html-sac="1" rendered="{!showLocalGLA}">	
								        	<apex:outputLabel value="{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__GeneralLedgerAccount__c.label}" styleClass="fieldLabel"/>
								        	<apex:outputPanel id="alternateAccountGlaPanelVAT">
												<span class="popupDataFieldOutput">
													<apex:outputField value="{!lineItemVAT.dto.c2g__GeneralLedgerAccount__c}"/>
												</span>
											</apex:outputPanel>	
								        </apex:pageBlockSectionItem>
								        <apex:pageBlockSectionItem html-sac="1" rendered="{!allowLocalGLA && !showLocalGLA}">	
                                            <apex:outputLabel value="{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__LocalGLA__c.label}" styleClass="fieldLabel"/>
								        	<apex:outputPanel id="alternateAccountLocalGlaPanelVAT">
												<span class="popupDataFieldOutput">
                                                    <apex:outputField value="{!lineItemVAT.dto.c2g__LocalGLA__c}"/>
												</span>
											</apex:outputPanel>	
								        </apex:pageBlockSectionItem>
									</apex:pageBlockSection>
                                        <apex:outputPanel id="lineItemVATDimensionBlock">
                                        	<c:SubAnalysis record="{!lineItemVAT.dto}" onChangeDimensions="if(!isAnalysisReady) return false;CODA.indicatorOn('{!$Label.c2g__chartofaccountsmappingsretrieving}');reloadAlternateAccount('{!lineItemVAT.dto.c2g__LineNumber__c}');" title="{!$Label.c2g__codanotesandanalysis}" readOnly="false" intercompany-detail="true" lineNumber="{!lineItemVAT.LineNumber}" rendered="{!allowLocalGLA && viewstate.EnableOverrideProductGLA}"/>
                                            <c:SubAnalysis record="{!lineItemVAT.dto}" title="{!$Label.c2g__codanotesandanalysis}" readOnly="false" intercompany-detail="true" lineNumber="{!lineItemVAT.LineNumber}" rendered="{! OR(!allowLocalGLA, !viewstate.EnableOverrideProductGLA)}"/>
                                        </apex:outputPanel>
                                        <!-- CUSTOM FIELDS LINE ITEM VAT -->
                                        <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceeditadditionalinformation}" id="customFieldBlock" collapsible="false" columns="2" rendered="{!lineItemVAT.DynamicFieldsInfoTableLI.size > 0}">
                                            <apex:pageBlockTable id="dtDynamicFieldLineItemsVAT" value="{!lineItemVAT.DynamicFieldsInfoTableLI}" var="fieldVAT">
                                                <apex:column styleClass="widthauto">
                                                    <apex:outputText value="{!fieldVAT.DynamicFieldController.dynamicFieldInfo.label}"/>
                                                </apex:column>
                                                <apex:column styleClass="widthauto">
                                                	<!--
    												The implementation using new feature Dynamic Binding in VF would be much easier, efficient and user friendly. We would not need any custom component
    												<apex:repeat value="{!myFieldList}" var="f">
    													<apex:outputField value="{!account[f]}"/>
    												</apex:repeat>
    												 -->
                                                    <c:CODADynamicField m_fieldinfo="{!fieldVAT.DynamicFieldController.DynamicFieldInfo}" m_mode="EDIT" m_objectc="codaInvoiceLineItem__c"/>
                                                </apex:column>
                                            </apex:pageBlockTable>
                                        </apex:pageBlockSection>
                                    </apex:outputPanel>
                                </c:AnalysisPopup>
                            </span>
                        </apex:outputPanel>
                    </apex:column>

                    <apex:column styleClass="widthauto">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__Product__c.label}</apex:facet>
                        <apex:outputPanel id="productPanelVAT">
                            <apex:inputField id="productVAT" value="{!lineItemVAT.dto.c2g__Product__c}"/>
                            <script>
                                CODA.addQueuedOnBlurEventWithParam(null, "{!$Component.productVAT}", "{!$Label.codaPageInvoiceEditCalculatingTax18}", onChangeProductVAT, {!lineItemVAT.LineNumber-1}, true);
                            </script>
                        </apex:outputPanel>
                    </apex:column>

                    <apex:column styleClass="widthauto" rendered="{!!showLocalGLA && viewstate.EnableOverrideProductGLA}">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__GeneralLedgerAccount__c.label}</apex:facet>
                    	<apex:inputField id="overrideGLAVAT" value="{!lineItemVAT.dto.c2g__GeneralLedgerAccount__c}" onChange="CODA.indicatorOn('{!$Label.c2g__chartofaccountsmappingsretrieving}'); onChangeGLA({!lineItemVAT.dto.c2g__LineNumber__c - 1})" rendered="{!allowLocalGLA}"/>
                        <apex:inputField id="overrideGLAVATNonLocal" value="{!lineItemVAT.dto.c2g__GeneralLedgerAccount__c}" rendered="{!!allowLocalGLA}"/>
                    </apex:column>
                    
                    <apex:column styleClass="widthauto" rendered="{!showLocalGLA && viewstate.EnableOverrideProductGLA}">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__LocalGLA__c.label}</apex:facet>
                        <c:LookupPicklist styleClass="pick" sObjectFieldType="codaInvoiceLineItem__c.LocalGLA__c" onChange="CODA.indicatorOn('{!$Label.c2g__chartofaccountsmappingsretrieving}'); onChangeGLA({!lineItemVAT.dto.c2g__LineNumber__c - 1})" recentItems="3" lookupValue="{!lineItemVAT.dto.c2g__LocalGLA__c}" LabelFormatting="{Name} - {ReportingCode__c}"/>
					</apex:column>

                    <apex:column styleClass="widthsmall" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__Quantity__c.label}</apex:facet>
                        <apex:inputText id="quantityVAT" disabled="{!!lineItemVAT.isProductSet}" value="{!lineItemVAT.Quantity}" required="false" styleClass="alignright"/>
                        <script>
                            CODA.addQueuedOnBlurEventWithParam("onChangeLine{!lineItemVAT.LineNumber}", "{!$Component.quantityVAT}", "{!$Label.codaPageInvoiceEditCalculatingLine7}", onChangeLineVAT, {!lineItemVAT.LineNumber-1});
                        </script>
                        <apex:message for="quantityVAT" styleClass="errorMsg"/>
                    </apex:column>

                    <apex:column styleClass="widthmedium" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__UnitPrice__c.label}</apex:facet>
                        <apex:outputPanel id="unitPriceVATPanel">
                            <apex:inputText id="unitPriceVAT" disabled="{!!lineItemVAT.isProductSet}" value="{!lineItemVAT.UnitPrice}" required="false" styleClass="alignright"/>
                            <script>
                                CODA.addQueuedOnBlurEventWithParam("onChangeLine{!lineItemVAT.LineNumber}", "{!$Component.unitPriceVAT}", "{!$Label.codaPageInvoiceEditCalculatingLine8}", onChangeLineVAT, {!lineItemVAT.LineNumber-1});

                                CODA.prettifySalesforceRunTimeError();
                            </script>
                            <apex:message for="unitPriceVAT" styleClass="errorMsg"/>
                        </apex:outputPanel>
                    </apex:column>

                    <apex:column styleClass="widthmedium">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxCode1__c.label}</apex:facet>
                        <apex:outputPanel id="taxCodePanelVAT">
                            <apex:inputField id="taxCodeVAT" rendered="{!lineItemVAT.isProductSet}" value="{!lineItemVAT.dto.c2g__TaxCode1__c}"/>
                            <!-- The below input text is dummy for taxcode1. It is rendered when there is no product set on line. It is always disable. -->
                            <apex:inputText rendered="{!!lineItemVAT.isProductSet}" disabled="true"/>
                            <script>
                                CODA.addQueuedOnBlurEventWithParam(null, "{!$Component.taxCodeVAT}", "{!$Label.codaPageInvoiceEditCalculatingTax19}", onChangeTaxCodeVAT, {!lineItemVAT.LineNumber-1});

                                CODA.prettifySalesforceRunTimeError();
                            </script>
                        </apex:outputPanel>
                    </apex:column>
                    <apex:column styleClass="widthmedium" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxValue1__c.label}</apex:facet>
                        <apex:outputPanel id="taxPanelValueVAT">
                            <apex:inputText id="taxValueVAT" disabled="{!!lineItemVAT.isProductSet}" value="{!lineItemVAT.TaxValue1}" styleClass="alignright"/>
                            <script>
                                CODA.addQueuedOnBlurEvent("calculateTax", "{!$Component.taxValueVAT}", "{!$Label.codaPageInvoiceEditCalculatingTax20}", calculateTax);

                                CODA.prettifySalesforceRunTimeError();
                            </script>
                            <apex:message for="taxValueVAT" styleClass="errorMsg"/>
                        </apex:outputPanel>
                    </apex:column>

                    <apex:column styleClass="widthmedium alignright" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__NetValue__c.label}</apex:facet>
                        <apex:outputText id="netValueVAT" value="{!lineItemVAT.NetValue}"/>
                    </apex:column>
                    <apex:column styleClass="widthmedium alignright" headerClass="alignleft">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__IncomeSchedule__c.label}</apex:facet>
                        <apex:inputField id="incomeScheduleVAT" value="{!lineItemVAT.dto.c2g__IncomeSchedule__c}"/>
                        <script>
                            CODA.addQueuedOnBlurEventWithParam(null, "{!$Component.incomeScheduleVAT}", "{!$Label.codaInvoiceIncomeScheduleUpdatingIncomeScheduleEdit}", onChangeIncomeScheduleVAT, {!lineItemVAT.LineNumber-1}, true);
                        </script>
                    </apex:column>
                    <apex:column styleClass="widthsmall aligncenter" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__IncomeScheduleGroup__c.label}</apex:facet>
                        <apex:outputField id="incomeScheduleGroup" value="{!lineItemVAT.dto.c2g__IncomeScheduleGroup__c}"/>
                    </apex:column>
                    <apex:column styleClass="widthicon alignright">
                        <apex:facet name="header">&nbsp;</apex:facet>
                        <apex:commandButton id="incomeScheduleButton" title="{!$Label.c2g__codainvoiceincomeschedulescheduleinformationedit}" image="{!URLFOR($Resource.c2g__coda2go, 'coda2go/web/images/FinancialForceScheduleInformationIcon.png')}" action="{!lineItemVAT.scheduleInformation}" rendered="{!lineItemVAT.ScheduleInformationButtonStatus}" styleClass="incomeScheduleButton"/>
                    </apex:column>
                    <apex:column styleClass="widthicon alignright" headerClass="pageBlockTableNoLabelHeader">
                        <apex:facet name="header">&nbsp;</apex:facet>

                        <a href="javascript:CODA.addEventToQueueWithParam('removeLineItem{!lineItemVAT.LineNumber}', removeLineItemVAT, {!lineItemVAT.SequenceNo}, '{!$Label.codaPageInvoiceEditRemovingLine4}', true);" class="deleteIcon">
                        </a>
                    </apex:column>
                </apex:pageBlockTable>

                <apex:outputPanel id="newLineSUT" rendered="{!viewstate.useMultipleTaxCodes}">
                    <input type="button"  class="newlinebutton" onclick="if({!viewstate.showNewLineButton} == false) return false; isAnalysisReady=false; CODA.addEventToQueue('addLineItemSUT',addLineItemSUT,'{!$Label.codaPageInvoiceEditAddingLine3}',true); this.disabled=true; " value="{!$Label.codaPageInvoiceEditNewLine3}"/>
                </apex:outputPanel>

                <apex:outputPanel id="newLineVAT" rendered="{!viewstate.isVat}">
                    <input type="button"  class="newlinebutton" onclick="if({!viewstate.showNewLineButton} == false) return false; isAnalysisReady=false; CODA.addEventToQueue('addLineItemVAT',addLineItemVAT,'{!$Label.codaPageInvoiceEditAddingLine4}',true); this.disabled=true;" value="{!$Label.codaPageInvoiceEditNewLine4}"/>
                </apex:outputPanel>
                <div class="clearboth"></div>
            </apex:pageBlockSection>

            <apex:actionFunction name="addLineItemSUT" action="{!addLineItem}" oncomplete="isAnalysisReady=true; CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');CODA.setFocus('{!$Component.invoiceBlock.lineItemSection.dtLineItemsSUT}','{!$Component.invoiceBlock.lineItemSection.dtLineItemsSUT.productSUT}'); checkErrorMessage(); CODA.prettifySalesforceRunTimeError();" reRender="messagePanel,priceBookMessagePanel,currency,invoiceDetail,periodValue,dtLineItemsSUT,accountPanel,newLineSUT,headerDimensionBlock"/>
            <apex:actionFunction name="addLineItemVAT" action="{!addLineItem}" oncomplete="isAnalysisReady=true; CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');CODA.setFocus('{!$Component.invoiceBlock.lineItemSection.dtLineItemsVAT}','{!$Component.invoiceBlock.lineItemSection.dtLineItemsVAT.productVAT}'); checkErrorMessage(); CODA.prettifySalesforceRunTimeError();" reRender="messagePanel,priceBookMessagePanel,currency,invoiceDetail,periodValue,dtLineItemsVAT,accountPanel,newLineVAT,headerDimensionBlock"/>

            <!-- Summary -->
            <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceeditsummary2}" columns="2" collapsible="false">
                <!-- Tax Summary -->
                <apex:outputPanel layout="block" styleClass="taxsummaryarea">
                <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceedittaxsummary2}" columns="1" collapsible="false">
                    <apex:pageBlockTable id="dtTaxSummary" value="{!viewstate.invoice.taxSummaryItems}" var="taxSummary">
                        <apex:column >
                            <apex:facet name="header">{!viewstate.invoice.TaxSummaryTaxCodeHeading}</apex:facet>
                            <apex:outputText value="{!taxSummary.TaxCode}"/>
                        </apex:column>

                        <!-- Below column rendered depending on Tax Method - Sales and Use Tax -->
                        <apex:column styleClass="widthmed alignright" rendered="{!viewstate.showFullTaxSummary}">
                            <apex:facet name="header">
                                <apex:outputPanel layout="block">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxRate1__c.label}</apex:outputPanel>
                            </apex:facet>
                            <apex:outputText value="{!taxSummary.TaxRate}"/>
                        </apex:column>

                        <apex:column styleClass="alignright" headerClass="alignright" rendered="{!viewstate.isVat}">
                            <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__NetValue__c.label}</apex:facet>
                            <apex:outputText value="{!taxSummary.NetValue}"/>
                        </apex:column>
                        <apex:column styleClass="alignright" headerClass="alignright">
                             <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxValue1__c.label}</apex:facet>
                            <apex:outputText value="{!taxSummary.TaxValue}"/>
                        </apex:column>
                    </apex:pageBlockTable>
                </apex:pageBlockSection>
                </apex:outputPanel>
                <apex:panelGrid columns="4" border="0" width="100%" styleClass="detailList detailListnoPadding" columnClasses="labelCol widthauto,labelCol widthmedium,dataCol alignright widthmedium,labelCol widthspacer">
                    <apex:outputLabel value=" "/>
                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__NetTotal__c.label}"/>
                    <apex:outputText id="netTotal" value="{!viewstate.invoice.NetTotal}"/>
                    <apex:outputLabel value=" "/>

                    <apex:outputLabel value=" "/>
                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__TaxTotal__c.label}"/>
                    <apex:outputText id="taxTotal" value="{!viewstate.invoice.TaxTotal}"/>
                    <apex:outputLabel value=" "/>

                    <apex:outputLabel value=" "/>
                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__InvoiceTotal__c.label}"/>
                    <apex:outputText id="invTotal" value="{!viewstate.invoice.InvoiceTotal}"/>
                    <apex:outputLabel value=" "/>
                </apex:panelGrid>
            </apex:pageBlockSection>

            <!-- Payment Schedule -->
            <apex:outputPanel id="paymentScheduleOutputPanel">
                <apex:pageBlockSection id="paymentSchedulePageBlockSection" title="{!$Label.c2g__codapageinvoiceeditpaymentschedule}" collapsible="false" columns="1">
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__PaymentSchedule__c.label}" for="paymentSchedule"/>
                        <apex:outputPanel layout="block" id="scheduleTypeOutputPanel">
                            <apex:inputField id="paymentSchedule" value="{!viewstate.invoice.dto.c2g__PaymentSchedule__c}"/>
                            <apex:actionFunction name="onChangePaymentSchedule" action="{!viewstate.invoice.setDefaultPaymentScheduleValues}" oncomplete="CODA.resumeQueueProcessing();" reRender="paymentScheduleFieldsOutputPanel,dueDateOutputPanel"/>
                            <script>
                                CODA.addQueuedOnChangeEvent("onChangePaymentSchedule", "{!$Component.paymentSchedule}", "{!$Label.codaPageInvoiceEditUpdatingPaymentScheduleFields}", onChangePaymentSchedule, true)
                            </script>
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                </apex:pageBlockSection>

                <apex:outputPanel id="paymentScheduleFieldsOutputPanel">
                    <apex:pageBlockSection id="paymentScheduleFieldsPageBlockSection" rendered="{!viewstate.showPaymentSchedule}">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__NumberOfPayments__c.label}" for="numberOfPayments"/>
                            <apex:outputPanel >
                                <apex:inputField id="numberOfPayments" value="{!viewstate.invoice.dto.c2g__NumberOfPayments__c}" styleClass="widthsmall alignright"/>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__FirstDueDate__c.label}" for="firstDueDate"/>
                            <apex:outputPanel >
                                <apex:inputField id="firstDueDate" value="{!viewstate.invoice.dto.c2g__FirstDueDate__c}" required="{!viewstate.showPaymentSchedule}"/>
                                <script>
                                    CODA.addToFocusEvent("{!$Component.firstDueDate}");
                                </script>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__Interval__c.label}" for="interval"/>
                            <apex:outputPanel >
                                <apex:actionFunction name="calculatePaymentSchedule" action="{!calculatePaymentSchedule}" oncomplete="CODA.resumeQueueProcessing();CODA.setFocus('{!$Component.invoiceBlock.paymentSchedulePageBlockSection.paymentScheduleFieldsPageBlockSection.dtPaymentSchedule}','{!$Component.invoiceBlock.paymentSchedulePageBlockSection.paymentScheduleFieldsPageBlockSection.dtPaymentSchedule.amount}');incomeScheduleCompare.constructor();" reRender="messagePanel,priceBookMessagePanel,paymentScheduleFieldsOutputPanel,dtPaymentSchedule"/>
                                <apex:inputField id="interval" value="{!viewstate.invoice.dto.c2g__Interval__c}"/>
                                <input type="button" value="{!$Label.codaPageInvoiceEditCalculate}" class="btn" onclick="CODA.addEventToQueue('calculatePaymentSchedule',calculatePaymentSchedule,'{!$Label.codaPageInvoiceEditCalculatingPaymentSchedule}',true); this.disabled=true;"/>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem />
                        <apex:pageBlockTable id="dtPaymentSchedule" value="{!viewstate.invoice.installmentLineItems}" var="installmentLineItem">
                            <apex:column styleClass="widthlinenumbers">
                                <apex:facet name="header">&nbsp;</apex:facet>
                                <apex:outputField id="lineNumber" value="{!installmentLineItem.dto.c2g__LineNumber__c}"/>
                            </apex:column>
                            <apex:column styleClass="widthauto" headerClass="alignleft">
                                <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceInstallmentLineItem__c.fields.c2g__DueDate__c.label}</apex:facet>
                                <apex:inputField id="dueDate" value="{!installmentLineItem.dto.c2g__DueDate__c}" required="false"/>
                                <script>
                                    CODA.addToFocusEvent("{!$Component.dueDate}");
                                </script>
                            </apex:column>
                            <apex:column styleClass="alignright widthmedium" headerClass="alignright">
                                <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceInstallmentLineItem__c.fields.c2g__Amount__c.label}</apex:facet>
                                <apex:inputField id="amount" value="{!installmentLineItem.dto.c2g__Amount__c}" required="false" styleClass="alignright"/>
                            </apex:column>
                            <apex:column styleClass="widthicon alignright">
                                <apex:facet name="header">&nbsp;</apex:facet>
                                <a href="javascript:CODA.addEventToQueueWithParam('removeInstallmentLineItem{!installmentLineItem.LineNumber}', removeInstallmentLineItem, {!installmentLineItem.SequenceNo}, '{!$Label.codaPageInvoiceEditRemovingLine}', true);" class="deleteIcon">
                                </a>
                            </apex:column>
                        </apex:pageBlockTable>
                        <apex:actionFunction name="addPaymentInstallment" action="{!addInstallmentLineItem}" oncomplete="CODA.resumeQueueProcessing();CODA.setFocus('{!$Component.invoiceBlock.paymentSchedulePageBlockSection.paymentScheduleFieldsPageBlockSection.dtPaymentSchedule}','{!$Component.invoiceBlock.paymentSchedulePageBlockSection.paymentScheduleFieldsPageBlockSection.dtPaymentSchedule.dueDate}');incomeScheduleCompare.constructor();" reRender="messagePanel,priceBookMessagePanel,paymentScheduleFieldsOutputPanel,dtPaymentSchedule"/>
                        <apex:outputPanel id="newPaymentInstallment">
                            <input type="button" class="newlinebutton" onclick="CODA.addEventToQueue('addPaymentInstallment',addPaymentInstallment,'{!$Label.codaPageInvoiceEditAddingLine}',true); this.disabled=true;" value="{!$Label.codaPageInvoiceEditNewLine}"/>
                        </apex:outputPanel>
                    </apex:pageBlockSection>
                </apex:outputPanel>
            </apex:outputPanel>

            <!-- Income Schedule -->

            <apex:outputPanel id="incomeScheduleOutputPanel">

                <apex:pageBlockSection id="incomeSchedulePageBlockSection" title="{!$Label.c2g__codaincomeschedule}" rendered="{!viewstate.showIncomeSchedule}" collapsible="false" columns="2">
                    <apex:pageBlockSectionItem rendered="{!viewstate.showIncomeSchedule}">
                        <apex:outputText value="{!$Label.c2g__codaincomeschedule}"/>
                        <apex:outputPanel layout="block" id="incomeScheduleOutputblock">
                            <apex:outputField id="incomeSchedule" value="{!viewstate.invoice.dto.c2g__IncomeSchedule__c}" />
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem rendered="{!viewstate.showIncomeSchedule}">
                    	<apex:outputText value="{!$Label.c2g__codaincomescheduleinvoicenettotal}"/>

						<apex:outputPanel id="netTotal" styleClass="largeValue">
							{!viewstate.currencySymbol}<span class="netTotal"><apex:outputText value="{!viewstate.invoice.incomeScheduleNetTotalAsString}"/></span>
						</apex:outputPanel>
                    </apex:pageBlockSectionItem>
                </apex:pageBlockSection>

                <apex:outputPanel id="incomeScheduleFieldsOutputPanel">
                        <apex:pageBlockSection id="incomeScheduleFieldsPageBlockSection" rendered="{!viewstate.showIncomeSchedule}" >
                                <apex:pageBlockSectionItem >
                                    <apex:outputLabel value="{!$Label.c2g__codaincomeschedulenumberofjournal}"/>
                                    <apex:outputPanel >
                                        <apex:inputField id="numberOfJournals" value="{!viewstate.invoice.dto.c2g__NumberofJournals__c}" />
                                    </apex:outputPanel>
                                </apex:pageBlockSectionItem>
                                <apex:pageBlockSectionItem >
                                    <apex:outputLabel value="{!$Label.c2g__codaincomeschedulestartdate}" />
                                    <apex:outputPanel >
                                        <apex:inputField id="startDate" value="{!viewstate.invoice.dto.c2g__StartDate__c}" />
                                        <script>
                                            CODA.addToFocusEvent("{!$Component.startDate}");
                                        </script>
                                    </apex:outputPanel>
                                </apex:pageBlockSectionItem>
                                <apex:pageBlockSectionItem >
                                    <apex:outputLabel value="{!$Label.c2g__codaincomescheduleperiodintervals}" for="interval"/>
                                    <apex:outputPanel >
                                        <apex:inputField id="periodInterval" value="{!viewstate.invoice.dto.c2g__PeriodInterval__c}" />
                                    </apex:outputPanel>
                                </apex:pageBlockSectionItem>
                                <apex:pageBlockSectionItem >
                                    <apex:outputLabel value="{!$Label.c2g__codaincomescheduleusepartperiods}" for="interval"/>
                                    <apex:outputPanel >
                                        <apex:inputCheckbox id="partPeriods" value="{!viewstate.invoice.dto.c2g__Usepartperiods__c}"/>
                                    </apex:outputPanel>
                                </apex:pageBlockSectionItem>

                                <apex:pageBlockSectionItem >
                                	<span>&nbsp;</span>
                                    <apex:outputPanel styleClass="alignright">
                                        <apex:actionFunction name="calculateIncomeSchedule" action="{!calculateIncomeSchedule}" oncomplete="CODA.resumeQueueProcessing();incomeScheduleCompare.constructor();incomeScheduleCompare.constructor();" reRender="calculateIncomeSchedule,incomeScheduleOutputPanel,messagePanel"/>
                                        <input type="button" value="{!$Label.codaIncomeScheduleReCalculate}" class="btn" onclick="CODA.addEventToQueue('calculateIncomeSchedule',calculateIncomeSchedule,'{!$Label.codaIncomeScheduleCalculation}',true); this.disabled=true;"/>
                                    </apex:outputPanel>
                                </apex:pageBlockSectionItem>

                            <apex:pageBlockSectionItem />
                                <apex:pageBlockTable id="dtPaymentSchedule" value="{!viewstate.invoice.scheduleLineItems}" var="scheduleLineItem">
                                    <apex:column styleClass="widthauto" headerClass="widthauto" footerClass="alignright pageBlockTableNoLabelFooter">
                                        <apex:facet name="header">
                                            {!$Label.c2g__codaincomescheduleyearperiod}
                                        </apex:facet>
                                        <apex:facet name="footer">
											{!$Label.c2g__codaincomescheduleincomescheduletotal}
										</apex:facet>
                                        <apex:inputField value="{!scheduleLineItem.dto.c2g__Period__c}" id="period"/>
                                    </apex:column>
                                    <apex:column styleClass="widthlarge alignright" headerClass="widthlarge alignright" footerClass="widthlarge alignright pageBlockTableNoLabelFooter">
                                        <apex:facet name="header">
                                            <div style="margin-right:7px;">
                                            	{!$Label.codaIncomeScheduleAmount}
                                            </div>
                                        </apex:facet>
                                        <apex:facet name="footer">
											<apex:outputPanel layout="block" style="margin-right:7px;">
												<apex:outputPanel styleClass="largeValue" id="incomeScheduleTotalOutputPanel">
													<span class="currencySymbol">{!viewstate.currencySymbol}</span>
													<apex:outputText value="{0,number,#,###,###,###,###,###.00}" styleClass="scheduleTotal">
														<apex:param value="{!viewstate.invoice.incomeScheduleTotal}"/>
													</apex:outputText>
												</apex:outputPanel>
											</apex:outputPanel>
										</apex:facet>
                                        <apex:inputField id="amount" value="{!scheduleLineItem.dto.c2g__Amount__c}" required="false" styleClass="alignright calculateInput"/>
                                    </apex:column>
                                    <apex:column styleClass="widthmedium aligncenter" headerClass="widthmedium aligncenter" footerClass="widthmedium aligncenter pageBlockTableNoLabelFooter">
                                     	<apex:facet name="header">
											{!$Label.c2g__codainvoiceincomeschedulesavepost}
                                     	</apex:facet>
                                     	<apex:facet name="footer">&nbsp;</apex:facet>
	                                    <apex:outputPanel layout="block" styleClass="radioTable">
		                                    <apex:selectRadio value="{!scheduleLineItem.toPost}" styleClass="radioTable">
												<apex:selectOption itemValue="false"/>
		 										<apex:selectOption itemValue="true"/>
											</apex:selectRadio>
										</apex:outputPanel>
									</apex:column>
                                </apex:pageBlockTable>
                        </apex:pageBlockSection>
                    </apex:outputPanel>
            </apex:outputPanel>

        </apex:pageBlock>
        <!-- Product Finder -->
        <apex:outputPanel layout="block" id="pricebooksearch">
            <apex:pageBlock title="{!$Label.c2g__codapageinvoiceeditpricebooksearch}" rendered="{!viewstate.RenderProductSearch}">
                <!-- Buttons -->
                <apex:pageBlockButtons >
                    <apex:actionFunction name="addSearchLines" action="{!addSelectedLineItemsFromProduct}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="messagePanel,priceBookMessagePanel,currency,dtLineItemsSUT,dtLineItemsVAT,netTotal,taxTotal,invTotal,dtTaxSummary,productsList,accountPanel,currency,invoiceScheduleOutputPanel,incomeScheduleOutputPanel"/>
                    <a class="newlinebutton" href="javascript:CODA.addEventToQueue('addSearchLines', addSearchLines, '{!$Label.c2g__codapageinvoiceeditaddingselectedprodu2}', true);">{!$Label.c2g__codapageinvoiceeditaddselectedlines2}</a>
                </apex:pageBlockButtons>

                <apex:pageBlockSection columns="1">
                    <apex:pageMessage summary="{!$Label.c2g__codapageinvoiceeditenterpartialcriteri2}" severity="info" strength="1"/>
                </apex:pageBlockSection>

                <!-- Messages -->
                <apex:pageBlockSection columns="1" id="priceBookMessagePanel">
                     <apex:pageMessage summary="{!viewstate.priceBookErrorMessage}" severity="error" strength="1" rendered="{!viewstate.showPriceBookErrorMessage}"/>
                </apex:pageBlockSection>

                <apex:pageBlockSection columns="1">
                    <apex:panelGrid columns="3">
                        <apex:inputText value="{!viewstate.searchProducts}" id="searchCriteria" />
                        <apex:actionFunction name="callSearch" action="{!searchForProducts}" oncomplete="CODA.resumeQueueProcessing();CODA.setExpanderIconState('edit');" reRender="messagePanel,priceBookMessagePanel,productsList,headerDimensionBlock,lineItemVATDimensionBlock,lineItemSUTDimensionBlock" />
                        <input type="button" class="btn" onclick="CODA.addEventToQueue('callSearch', callSearch, '{!$Label.codaPageInvoiceEditSearchingForProduct2}', true);"  value="{!$Label.codaPageInvoiceEditSearch}" />
                        <apex:panelGroup >
                            <apex:selectRadio value="{!viewstate.searchBy}">
                                <apex:selectOption itemValue="byname" itemLabel="{!$Label.c2g__codapageinvoiceeditbyname2}"/>
                                <apex:selectOption itemValue="bycode" itemLabel="{!$Label.c2g__codapageinvoiceeditbycode2}"/>
                            </apex:selectRadio>
                        </apex:panelGroup>
                    </apex:panelGrid>
                </apex:pageBlockSection>
                
                <apex:pageBlockSection columns="1">
                    <apex:outputPanel id="productsList" layout="inline">
                        <apex:pageBlockTable id="productListTable" value="{!viewstate.products}" var="product" columnClasses="widthsmall,widthauto,widthauto,widthmedium,widthmedium">
                            <apex:column styleClass="widthsmall aligncenter" headerClass="widthsmall aligncenter">
                                <apex:facet name="header">
                                    <apex:outputPanel layout="block" styleClass="aligncenter">
                                        <apex:inputCheckbox id="selectAllProducts" value="{!viewstate.SelectAll}" onclick="CODA.toggleControlCheckbox(this, '{!$Component.productListTable}');"/>
                                    </apex:outputPanel>
                                </apex:facet>
                                <apex:inputCheckbox id="selectProduct_column" value="{!product.Select}" onclick="CODA.toggleChildCheckbox('{!$Component.productListTable}', 'productListTable', this);"/>
                            </apex:column>
                            <apex:column styleClass="widthauto" headerClass="widthauto">
                                <apex:facet name="header">{!$Label.c2g__codapageinvoiceeditname2}</apex:facet>
                                <apex:outputText value="{!product.Name}"/>
                            </apex:column>
                            <apex:column styleClass="widthmedium" headerClass="widthmedium">
                                <apex:facet name="header">{!$Label.c2g__codapageinvoiceeditcode2}</apex:facet>
                                <apex:outputText value="{!product.Code}"/>
                            </apex:column>
                            <apex:column styleClass="widthauto" headerClass="widthauto">
                                <apex:facet name="header">{!$Label.c2g__codapageinvoiceeditpricebook2}</apex:facet>
                                <apex:outputText value="{!product.PriceBookName}"/>
                            </apex:column>
                            <apex:column styleClass="alignright widthmedium" headerClass="alignright widthmedium">
                                <apex:facet name="header">{!$Label.c2g__codapageinvoiceeditprice2}</apex:facet>
                                <apex:outputText value="{!product.Price}"/>
                            </apex:column>
                            <apex:column styleClass="alignright widthicon" headerClass="alignright widthicon">
                                <apex:facet name="header">&nbsp;</apex:facet>
                                <a href="javascript:CODA.addEventToQueueWithParam('addSearchLine{!product.RowNumber}', addSearchLine, {!product.RowNumber}, '{!$Label.codaPageInvoiceEditAddingProduct2}', true);"  class="newlinebutton">
                                </a>
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:outputPanel>
                </apex:pageBlockSection>
            </apex:pageBlock>
        </apex:outputPanel>

        <apex:outputPanel >
            <apex:pageBlock mode="edit" title="{!$Label.c2g__codapageinvoiceeditprintedtext}">            
                <apex:pageBlockSection >
                    <a href="javascript:CODA.togglePageBlockSection('{!$Component.printedTextBlock}','printedTextLink','{!$Label.codaPageInvoiceEditHidePrintedText}','{!$Label.codaPageInvoiceEditMaintainPrintedText}');"  id="printedTextLink">{!$Label.codaPageInvoiceEditMaintainPrintedText}</a>
                </apex:pageBlockSection>
                <apex:pageBlockSection />

                <apex:outputPanel id="printedTextBlock">
                    <!-- Extra Information 1 Section -->
                    <apex:pageBlockSection columns="1" title="{!$Label.c2g__codapageinvoiceeditprintedtext}">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="{!$Label.c2g__codapageinvoiceedittextdef1}"/>
                            <apex:outputPanel >
                                <apex:selectList id="textDefName1" value="{!viewState.invoice.textDefinition1Name}"  multiselect="false" size="1">
                                    <apex:selectOptions value="{!textDefinition1Names}"/>
                                </apex:selectList>
                                <apex:actionFunction name="onChangeTextDef1"  action="{!viewState.invoice.updateTextDefinition1Data}" oncomplete="CODA.resumeQueueProcessing();" reRender="textDefDetails1"/>
                                <script>
                                    CODA.addQueuedOnChangeEvent("onChangeTextDef1", "{!$Component.textDefName1}", "{!$Label.codaPageInvoiceEditUpdatingTextDef}", onChangeTextDef1);
                                </script>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>

                    <apex:outputPanel id="textDefDetails1">
                    <apex:pageBlockSection rendered="{!viewState.invoice.showPrintedText1Panel}" columns="1">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel id="heading1Label" value="{!$Label.c2g__codapageinvoiceeditheading}"/>
                            <apex:outputPanel id="heading1Panel">
                                <apex:inputText id="heading1" value="{!viewstate.invoice.dto.c2g__PrintedText1Heading__c}" />
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel id="text1Label" value="{!$Label.c2g__codapageinvoiceedittext}"/>
                            <apex:outputPanel id="text1Panel">
                                <apex:inputTextarea id="text1" rows="3" cols="86" value="{!viewstate.invoice.dto.c2g__PrintedText1Text__c}"/>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>
                    </apex:outputPanel>
                          
                    <!-- Extra Information 2 Section -->
                    <apex:pageBlockSection columns="1">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="{!$Label.c2g__codapageinvoiceedittextdef2}"/>
                            <apex:outputPanel >
                                <apex:selectList id="textDefName2" value="{!viewState.invoice.textDefinition2Name}"  multiselect="false" size="1">
                                    <apex:selectOptions value="{!textDefinition2Names}"/>
                                </apex:selectList>
                                <apex:actionFunction name="onChangeTextDef2"  action="{!viewState.invoice.updateTextDefinition2Data}" oncomplete="CODA.resumeQueueProcessing();" reRender="textDefDetails2"/>
                                <script>
                                    CODA.addQueuedOnChangeEvent("onChangeTextDef2", "{!$Component.textDefName2}", "{!$Label.codaPageInvoiceEditUpdatingTextDef}", onChangeTextDef2);
                                </script>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>

                    <apex:outputPanel id="textDefDetails2">
                    <apex:pageBlockSection rendered="{!viewState.invoice.showPrintedText2Panel}" columns="1">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel id="heading2Label" value="{!$Label.c2g__codapageinvoiceeditheading}"/>
                            <apex:outputPanel id="heading2Panel">
                                <apex:inputText id="heading2" value="{!viewstate.invoice.dto.c2g__PrintedText2Heading__c}" />
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel id="text2Label" value="{!$Label.c2g__codapageinvoiceedittext}" style="{!viewState.invoice.DisabledPrintedText2Style}"/>
                            <apex:outputPanel id="text2Panel">
                                <apex:inputTextarea id="text2" rows="3" cols="86" value="{!viewstate.invoice.dto.c2g__PrintedText2Text__c}"/>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>
                    </apex:outputPanel>

                    <!-- Extra Information 3 Section -->
                    <apex:pageBlockSection columns="1">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="{!$Label.c2g__codapageinvoiceedittextdef3}"/>
                            <apex:outputPanel >
                                <apex:selectList id="textDefName3" value="{!viewState.invoice.textDefinition3Name}"  multiselect="false" size="1">
                                    <apex:selectOptions value="{!textDefinition3Names}"/>
                                </apex:selectList>
                                <apex:actionFunction name="onChangeTextDef3"  action="{!viewState.invoice.updateTextDefinition3Data}" oncomplete="CODA.resumeQueueProcessing();" reRender="textDefDetails3"/>
                                <script>
                                    CODA.addQueuedOnChangeEvent("onChangeTextDef3", "{!$Component.textDefName3}", "{!$Label.codaPageInvoiceEditUpdatingTextDef}", onChangeTextDef3);
                                </script>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>

                    <apex:outputPanel id="textDefDetails3">
                    <apex:pageBlockSection rendered="{!viewState.invoice.showPrintedText3Panel}" columns="1">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel id="heading3Label" value="{!$Label.c2g__codapageinvoiceeditheading}"/>
                            <apex:outputPanel id="heading3Panel">
                                <apex:inputText id="heading3" value="{!viewstate.invoice.dto.c2g__PrintedText3Heading__c}" />
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel id="text3Label" value="{!$Label.c2g__codapageinvoiceedittext}"/>
                            <apex:outputPanel id="text3Panel">
                                <apex:inputTextarea id="text3" rows="3" cols="86" value="{!viewstate.invoice.dto.c2g__PrintedText3Text__c}"/>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>
                    </apex:outputPanel>

                    <!-- Extra Information 4 Section -->
                    <apex:pageBlockSection columns="1">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="{!$Label.c2g__codapageinvoiceedittextdef4}"/>
                            <apex:outputPanel >
                                <apex:selectList id="textDefName4" value="{!viewState.invoice.textDefinition4Name}"  multiselect="false" size="1">
                                    <apex:selectOptions value="{!textDefinition4Names}"/>
                                </apex:selectList>
                                <apex:actionFunction name="onChangeTextDef4"  action="{!viewState.invoice.updateTextDefinition4Data}" oncomplete="CODA.resumeQueueProcessing();" reRender="textDefDetails4"/>
                                <script>
                                    CODA.addQueuedOnChangeEvent("onChangeTextDef4", "{!$Component.textDefName4}", "{!$Label.codaPageInvoiceEditUpdatingTextDef}", onChangeTextDef4);
                                </script>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>

                    <apex:outputPanel id="textDefDetails4">
                    <apex:pageBlockSection rendered="{!viewState.invoice.showPrintedText4Panel}" columns="1">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel id="heading4Label" value="{!$Label.c2g__codapageinvoiceeditheading}"/>
                            <apex:outputPanel id="heading4Panel">
                                <apex:inputText id="heading4" value="{!viewstate.invoice.dto.c2g__PrintedText4Heading__c}" />
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel id="text4Label" value="{!$Label.c2g__codapageinvoiceedittext}"/>
                            <apex:outputPanel id="text4Panel">
                                <apex:inputTextarea id="text4" rows="3" cols="86" value="{!viewstate.invoice.dto.c2g__PrintedText4Text__c}"/>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>
                    </apex:outputPanel>

                    <!-- Extra Information 5 Section -->
                    <apex:pageBlockSection columns="1">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="{!$Label.c2g__codapageinvoiceedittextdef5}"/>
                            <apex:outputPanel >
                                <apex:selectList id="textDefName5" value="{!viewState.invoice.textDefinition5Name}"  multiselect="false" size="1">
                                    <apex:selectOptions value="{!textDefinition5Names}"/>
                                </apex:selectList>
                                <apex:actionFunction name="onChangeTextDef5"  action="{!viewState.invoice.updateTextDefinition5Data}" oncomplete="CODA.resumeQueueProcessing();" reRender="textDefDetails5"/>
                                <script>
                                    CODA.addQueuedOnChangeEvent("onChangeTextDef5", "{!$Component.textDefName5}", "{!$Label.codaPageInvoiceEditUpdatingTextDef}", onChangeTextDef5);
                                </script>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>

                    <apex:outputPanel id="textDefDetails5">
                    <apex:pageBlockSection rendered="{!viewState.invoice.showPrintedText5Panel}" columns="1">
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel id="heading5Label" value="{!$Label.c2g__codapageinvoiceeditheading}"/>
                            <apex:outputPanel id="heading5Panel">
                                <apex:inputText id="heading5" value="{!viewstate.invoice.dto.c2g__PrintedText5Heading__c}" />
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel id="text5Label" value="{!$Label.c2g__codapageinvoiceedittext}"/>
                            <apex:outputPanel id="text5Panel">
                                <apex:inputTextarea id="text5" rows="3" cols="86" value="{!viewstate.invoice.dto.c2g__PrintedText5Text__c}"/>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                    </apex:pageBlockSection>
                    </apex:outputPanel>

                    <script>
                        CODA.togglePageBlockSection('{!$Component.printedTextBlock}','printedTextLink','{!$Label.codaPageInvoiceEditHidePrintedText}','{!$Label.codaPageInvoiceEditMaintainPrintedText}');
                    </script>
                </apex:outputPanel>
            </apex:pageBlock>
        </apex:outputPanel>

        <script>
            CODA.setExpanderIconState('edit');
        </script>
    </apex:form>
</apex:page>