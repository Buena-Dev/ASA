<!-- IMPORTANT: This page has a unformatted text due to being a Service Pack fix -->
<!-- codainvoiceview -->
<apex:page standardController="c2g__codaInvoice__c" extensions="c2g.CODAHelpLoaderController,c2g.CODAInvoiceController" action="{!maximunNumberOfLinesReached}">
    <script src="{!URLFOR($Resource.coda2go,'coda2go/web/script/lib.js')}" type="text/javascript"></script>

    <apex:stylesheet value="{!URLFOR($Resource.c2g__coda2go,'coda2go/web/css/style.css')}"/>
    <apex:stylesheet value="{!URLFOR($Resource.c2g__front,'front/components/IncomeScheduleCompare/IncomeScheduleCompare.css')}"/>
    <script src="{!URLFOR($Resource.coda2go,'coda2go/web/script/lib.js')}" type="text/javascript"></script>
    <style>
    .clearBtn{border:none;background:none;}
    </style>
    <script>
        var CODA2GoButtons = new CODA2GoPage();
        var CODA2GoBtnSaveValue = "{!$Label.codaPageInvoiceViewProcessing}";
    </script>
    <apex:form onsubmit="if(CODA2GoButtons.disableSaveButtons){ return CODA2GoButtons.disableSaveButtons(); }">
        <!-- Header -->

        <!-- Avoid the usage of 'URLFOR' for Lightning enablement. -->
        <apex:sectionHeader title="{!$Label.c2g__codapageinvoiceviewinvoicedetail}" subtitle="{!viewstate.invoice.dto.Name}{!InvoiceGroupToString}" help="{!redirectForHelp1030}"/>

        <!-- Back to Invoices -->
        <DIV class="goBreadcrumb">
        &nbsp;&#171;<a href="{!URLFOR($Action.codaInvoice__c.Tab,$ObjectType.codaInvoice__c)}">{!$Label.codaPageInvoiceViewBackToListInvoices}</a>
        </DIV>
        <!-- Invoice Detail -->
        <apex:pageBlock title="{!$Label.c2g__codapageinvoiceviewinvoicedetail2}">
            <!-- Buttons -->
            <apex:pageBlockButtons >
                <!-- Hidden Buttons -->
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewamendduedate}" id="amendDueDate_h" action="{!gotoAmendDuedate}" rendered="{!viewstate.invoice.canAmendDueDate}" styleclass="hiddensubmit"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewedit}" id="edit_h" action="{!edit}" rendered="{!viewstate.invoice.canEdit}" styleclass="hiddensubmit" disabled="{!HaveInvGroup}"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewdiscard}" id="discard_h" action="{!gotoDiscard}" rendered="{!viewstate.invoice.canDiscard}" styleclass="hiddensubmit"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewpost}" id="post_h" action="{!post}" rendered="{!viewstate.invoice.canPost}" styleclass="hiddensubmit"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewpost}" id="postVal_h" action="{!postVal}" rendered="{!viewstate.invoice.canPostVal}" styleclass="hiddensubmit"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewconverttocreditnote}" id="convert_h" action="{!convertToCreditNote}" styleclass="hiddensubmit"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewemailpdf}" id="emailPDF_h" onclick="return;" action="{!email}" rendered="{!viewstate.invoice.canEmail}" styleclass="hiddensubmit"/>
                <!-- End of Hidden Buttons -->
                <div>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewamendduedate2}" id="amendDueDate" rendered="{!viewstate.invoice.canAmendDueDate && ($Permission.c2g__SalesInvoiceAmend || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c)}" onclick="document.getElementById('{!$Component.amendDueDate_h}').click();return false;" rerender=""/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewedit2}" id="edit" rendered="{!viewstate.invoice.canEdit && ($Permission.c2g__SalesInvoiceEdit || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c)}" onclick="document.getElementById('{!$Component.edit_h}').click();return false;" rerender="" disabled="{!HaveInvGroup}"/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewdiscard2}" id="discard" rendered="{!viewstate.invoice.canDiscard && ($Permission.c2g__SalesInvoiceDiscard || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c)}" onclick="document.getElementById('{!$Component.discard_h}').click();return false;" rerender=""/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewpost2}" id="post" rendered="{!viewstate.invoice.canPost && ($Permission.c2g__SalesInvoicePost || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c)}" onclick="document.getElementById('{!$Component.post_h}').click();return false;" rerender=""/>
                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewpost2}" id="postVal" rendered="{!viewstate.invoice.canPostVal && ($Permission.c2g__SalesInvoicePost || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c)}" onclick="document.getElementById('{!$Component.postVal_h}').click();return false;" rerender=""/>

                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewpreview}" id="preview" onClick="integrationRuleCheck('{!viewstate.printUrl}');" oncomplete="if(CODA2GoButtons) CODA2GoButtons.enableSaveButtons();" rendered="{!viewstate.invoice.canPreview && ($Permission.c2g__SalesInvoicePreview || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c)}" reRender="messages"/>

				<apex:commandButton value="{!$Label.c2g__codapageinvoiceviewprint2}" id="print" action="{!print}" oncomplete="CODA2GoButtons.enableSaveButtons(); if(isValidCompany) integrationRuleCheck('{!viewstate.printUrl}');" rendered="{!viewstate.invoice.canPrint && ($Permission.c2g__SalesInvoicePrint || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c)}" reRender="jsCompanyMode,messages"/>

                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewviewpdf}" id="viewPDF" onClick="integrationRuleCheck('{!viewstate.pdfUrl}');" oncomplete="if(CODA2GoButtons) CODA2GoButtons.enableSaveButtons();" rendered="{!viewstate.invoice.canViewPDF && ($Permission.c2g__SalesInvoiceViewPDF || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c)}" reRender="messages"/>

                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewprintpdf2}" id="printPDF" action="{!print}" oncomplete="CODA2GoButtons.enableSaveButtons(); if(isValidCompany) integrationRuleCheck('{!viewstate.pdfUrl}');" rendered="{!viewstate.invoice.canPrint && ($Permission.c2g__SalesInvoicePrintPDF || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c)}" reRender="jsCompanyMode,messages"/>

				<apex:commandButton value="{!$Label.c2g__codapageinvoiceviewemailpdf2}" id="emailPDF" rendered="{!viewstate.invoice.canEmail && ($Permission.c2g__SalesInvoiceEmailPDF || $Setup.codaAccountingSettings__c.DisableCustomPermissions__c)}" onclick="return integrationRuleCheckWithButton('{!$Component.emailPDF_h}');" rerender=""/>

                <apex:commandButton value="{!$Label.c2g__codapageinvoiceviewconverttocreditnote2}" id="convert" rendered="{!viewstate.invoice.canConvertToCreditNote}" onclick="if ({!viewstate.invoice.HasIncomeSchedule}){ if (confirm('{!$Label.c2g__codacannotconvertocreditnotewithincome}')) { document.getElementById('{!$Component.convert_h}').click();return false; } else return false; } else { document.getElementById('{!$Component.convert_h}').click();return false; }" rerender="" STYLE="margin:3px 0px 0px 2px;"/>
                </div>
                <script>
                    var CODA2GoButtonArray = "";

                    if(document.getElementById("{!$Component.amendDuedate}"))
                        CODA2GoButtonArray = CODA2GoButtonArray + ',' + "{!$Component.amendDueDate}";

                    if(document.getElementById("{!$Component.edit}"))
                        CODA2GoButtonArray = CODA2GoButtonArray + ',' + "{!$Component.edit}";

                    if(document.getElementById("{!$Component.discard}"))
                        CODA2GoButtonArray = CODA2GoButtonArray + ',' + "{!$Component.discard}";

                    if(document.getElementById("{!$Component.post}"))
                        CODA2GoButtonArray = CODA2GoButtonArray + ',' + "{!$Component.post}";

                    if(document.getElementById("{!$Component.postVal}"))
                        CODA2GoButtonArray = CODA2GoButtonArray + ',' + "{!$Component.postVal}";

                    if(document.getElementById("{!$Component.preview}"))
                        CODA2GoButtonArray = CODA2GoButtonArray + ',' + "{!$Component.preview}";

                    if(document.getElementById("{!$Component.print}"))
                        CODA2GoButtonArray = CODA2GoButtonArray + ',' + "{!$Component.print}";

                    if(document.getElementById("{!$Component.viewPDF}"))
                        CODA2GoButtonArray = CODA2GoButtonArray + ',' + "{!$Component.viewPDF}";

                    if(document.getElementById("{!$Component.printPDF}"))
                        CODA2GoButtonArray = CODA2GoButtonArray + ',' + "{!$Component.printPDF}";

                    if(document.getElementById("{!$Component.emailPDF}"))
                        CODA2GoButtonArray = CODA2GoButtonArray + ',' + "{!$Component.emailPDF}";

                    if(document.getElementById("{!$Component.convert}"))
                        CODA2GoButtonArray = CODA2GoButtonArray + ',' + "{!$Component.convert}";

                    var myCODA2GoButtonArray = CODA2GoButtonArray.substr(1).split(",");
                    CODA2GoButtons.initButtons(myCODA2GoButtonArray);
                </script>


            </apex:pageBlockButtons>
            <!-- Messages -->
             <apex:outputPanel id="messages">
                <apex:pageMessage title="{!$Label.c2g__documentreadytopostwarning}" severity="warning" strength="2" rendered="{!viewstate.IsReadyPost}"/>
                <apex:include pageName="c2g__codamulticompanymodewarning" rendered="{!viewstate.isMultiCompanyMode}"/>
                <apex:include pageName="c2g__codacompanymismatchwarning"  rendered="{!viewstate.ownerCmpErr}"/> 
                <apex:pageMessages id="messagePanel"/>
            </apex:outputPanel>
            <!-- Account Detail -->
            <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceviewaccountdetail}">

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__Account__c.label}"/>
                    <apex:outputPanel >
                        <apex:outputField value="{!viewstate.invoice.dto.c2g__Account__c}"/>
                        <c:AnalysisPopup id="popupHeader" tooltip="{!$Label.c2g__codapageinvoiceviewtoggleanalysisarea}" allowConcurrentPopups="true">
                            <c:SubAnalysis record="{!viewstate.invoice.dto}" title="{!$Label.c2g__codaanalysis}" readOnly="true"/>
                            <!-- CUSTOM FIELDS HEADER -->
                            <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceviewadditionalinformation}" id="headerCustomBlock" collapsible="false" columns="1" rendered="{!viewstate.DynamicFieldsInfoTable.size > 0}">
                                <apex:pageBlockTable id="dtDynamicFields" value="{!viewstate.DynamicFieldsInfoTable}" var="fieldInfo">
                                    <apex:column styleClass="widthauto">
                                        <apex:outputText value="{!fieldInfo.DynamicFieldController.DynamicFieldInfo.label}"/>
                                    </apex:column>
                                    <apex:column styleClass="widthauto">
                                        <!--
                                        The implementation using new feature Dynamic Binding in VF would be much easier, efficient and user friendly. We would not need any custom component
                                        <apex:repeat value="{!myFieldList}" var="f">
                                            <apex:outputField value="{!account[f]}"/>
                                        </apex:repeat>
                                         -->
                                        <c:CODADynamicField m_fieldinfo="{!fieldInfo.DynamicFieldController.DynamicFieldInfo}" m_mode="VIEW" m_objectc="codaInvoice__c"/>
                                    </apex:column>
                                </apex:pageBlockTable>
                            </apex:pageBlockSection>
                        </c:AnalysisPopup>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!viewstate.isSalesAndUse}">&nbsp;</apex:pageBlockSectionItem>

                <!-- Below pageBlockSectionItem rendered depending on Tax Method -->

                <apex:pageBlockSectionItem rendered="{!viewstate.isSalesAndUse}">
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewtaxcodes}"/>

                    <apex:outputPanel >
                        <apex:outputPanel >
                            <apex:outputText value="{!viewstate.invoice.taxCodesAsString}"/>
                        </apex:outputPanel>
                        <c:AnalysisPopup tooltip="{!$Label.c2g__codapageinvoiceviewtoggletaxcodesarea}">
                            <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceviewtaxcodes2}" collapsible="false" columns="1">
                                <apex:panelGrid width="100%" columns="3" columnClasses="labelCol first, data2Col first,data2Col">
                                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__TaxCode1__c.label}"/>
                                    <apex:outputPanel styleClass="popupDataFieldOutput"><apex:outputField value="{!viewstate.invoice.dto.c2g__TaxCode1__c}"/></apex:outputPanel>
                                    <apex:outputPanel ><apex:outputText value="{!viewstate.invoice.TaxRate1}"/></apex:outputPanel>
                                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__TaxCode2__c.label}"/>
                                    <apex:outputPanel styleClass="popupDataFieldOutput"><apex:outputField value="{!viewstate.invoice.dto.c2g__TaxCode2__c}"/></apex:outputPanel>
                                    <apex:outputPanel ><apex:outputText value="{!viewstate.invoice.TaxRate2}"/></apex:outputPanel>
                                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__TaxCode3__c.label}"/>
                                    <apex:outputPanel styleClass="popupDataFieldOutput"><apex:outputField value="{!viewstate.invoice.dto.c2g__TaxCode3__c}"/></apex:outputPanel>
                                    <apex:outputPanel ><apex:outputText value="{!viewstate.invoice.TaxRate3}"/></apex:outputPanel>
                                </apex:panelGrid>
                            </apex:pageBlockSection>
                        </c:AnalysisPopup>

                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:outputField value="{!viewstate.invoice.dto.c2g__Opportunity__c}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewbillingaddress}"/>
                    <apex:outputPanel >
                    <apex:outputText value="{!viewstate.invoice.billingAddress.fullAddress}"/>&nbsp;
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewshippingaddress}"/>
                    <apex:outputPanel >
                    <apex:outputText value="{!viewstate.invoice.shippingAddress.fullAddress}"/>&nbsp;
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.canPrint}">
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewinvoiceemail}"/>
                    <apex:outputText value="{!viewstate.invoice.invoice.account.Dto.c2g__CODAInvoiceEmail__c}"/>
                </apex:pageBlockSectionItem>

            </apex:pageBlockSection>

            <!-- Invoice Detail -->
            <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceviewinvoicedetail3}">
                <apex:outputField id="invGroup" value="{!viewstate.invoice.dto.c2g__InvoiceGroup__c}"/>
                <apex:outputField value="{!viewstate.invoice.dto.c2g__Transaction__c}"/>

                <apex:outputField value="{!viewstate.invoice.dto.Name}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$Label.c2g__generateadjustmentjournal}"/>
                    <apex:outputPanel >
                         <apex:outputField id="generateAdjustmentJournal" value="{!viewstate.invoice.dto.c2g__GenerateAdjustmentJournal__c}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:outputField value="{!viewstate.invoice.dto.c2g__InvoiceDate__c}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewcustomerreference}"/>
                    <apex:outputPanel >
                        <apex:outputField value="{!viewstate.invoice.dto.c2g__CustomerReference__c}"/>&nbsp;
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__DueDate__c.label}" for="dueDate"/>
                    <apex:outputPanel id="dueDateOutputPanelView">
                        <apex:outputField id="dueDate" value="{!viewstate.invoice.dto.c2g__DueDate__c}" rendered="{!!viewstate.showPaymentSchedule}"/>
                        <apex:outputText id="paymentScheduleDueDate" value="{!$Label.c2g__codapageinvoiceviewpaymentschedule2}" rendered="{!viewstate.showPaymentSchedule}"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!viewstate.invoice.dto.c2g__Period__c}" id="periodValue"/>

                <apex:pageBlockSectionItem id="currencyblock">
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewinvoicecurrency}"/>
                    <apex:outputPanel >
                        <apex:outputText value="{!viewstate.invoice.invoice.invoiceCurrency.name}"/>
                        <c:ExchangeRateOverrides id="currencyRates" rateData="{!viewstate.invoice.exchangeRateData}" readOnly="true"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!viewstate.invoice.dto.c2g__ShippingMethod__c}"/>

                <apex:pageBlockSectionItem />
                <apex:outputField value="{!viewstate.invoice.dto.c2g__InvoiceDescription__c}"/>

            </apex:pageBlockSection>

            <!-- Invoice Line Items -->
            <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceviewinvoicelineitems}" columns="1">
                <apex:pageBlockTable id="dtLineItems" value="{!viewstate.invoice.lineItems}" var="lineItem" styleClass="noHover">
                    <apex:column styleClass="widthlinenumbers">
                        <apex:facet name="header">&nbsp;</apex:facet>
                        <apex:outputPanel >
                            <span style="white-space: nowrap">
                                <apex:outputField value="{!lineItem.dto.c2g__LineNumber__c}"/>
                                <c:AnalysisPopup id="popupLine" tooltip="{!$Label.c2g__codapageinvoiceviewtogglenotesandanaly}">
                                	<apex:pageBlockSection title="{!$Label.c2g__alternateaccount}" collapsible="false" columns="2" html-sac="1" rendered="{!allowLocalGLA && viewstate.EnableOverrideProductGLA}">
								        <apex:pageBlockSectionItem html-sac="1" rendered="{!showLocalGLA}">	
								        	<apex:outputLabel value="{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__GeneralLedgerAccount__c.label}" styleClass="fieldLabel"/>
								        	<apex:outputPanel >
												<span class="popupDataFieldOutput">
													<apex:outputField value="{!lineItem.dto.c2g__GeneralLedgerAccount__c}"/>
												</span>
											</apex:outputPanel>	
								        </apex:pageBlockSectionItem>
								        <apex:pageBlockSectionItem html-sac="1" rendered="{!allowLocalGLA && !showLocalGLA}">	
								        	<apex:outputLabel value="{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__LocalGLA__c.label}" styleClass="fieldLabel"/>
								        	<apex:outputPanel >
												<span class="popupDataFieldOutput">
													<apex:outputField value="{!lineItem.dto.c2g__LocalGLA__c}"/>
												</span>
											</apex:outputPanel>	
								        </apex:pageBlockSectionItem>
									</apex:pageBlockSection>
                                    <apex:outputPanel layout="block" styleClass="headerdetailsview" style="white-space: normal;">

                                        <c:SubAnalysis record="{!lineItem.dto}" title="{!$Label.c2g__codanotesandanalysis}" id="lineItemDimensionBlock" readOnly="true" intercompany-detail="true" lineNumber="{!lineItem.dto.c2g__LineNumber__c}"/>

                                        <!-- CUSTOM FIELDS LINE ITEM -->
                                        <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceviewadditionalinformation}" id="customFieldBlock" collapsible="false" columns="2" rendered="{!lineItem.DynamicFieldsInfoTableLI.size > 0}">
                                            <apex:pageBlockTable id="dtDynamicFieldLineItems" value="{!lineItem.DynamicFieldsInfoTableLI}" var="fieldLI">
                                                <apex:column styleClass="widthauto">
                                                    <apex:outputText value="{!fieldLI.DynamicFieldController.dynamicFieldInfo.label}"/>
                                                </apex:column>
                                                <apex:column styleClass="widthauto">
                                                    <!--
                                                    The implementation using new feature Dynamic Binding in VF would be much easier, efficient and user friendly. We would not need any custom component
                                                    <apex:repeat value="{!myFieldList}" var="f">
                                                        <apex:outputField value="{!account[f]}"/>
                                                    </apex:repeat>
                                                     -->
                                                    <c:CODADynamicField m_fieldinfo="{!fieldLI.DynamicFieldController.DynamicFieldInfo}" m_mode="VIEW" m_objectc="codaInvoiceLineItem__c"/>
                                                </apex:column>
                                            </apex:pageBlockTable>
                                        </apex:pageBlockSection>
                                    </apex:outputPanel>
                                </c:AnalysisPopup>
                            </span>                            
                        </apex:outputPanel>
                    </apex:column>
                    <apex:column >
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__Product__c.label}</apex:facet>
                        <apex:outputField value="{!lineItem.dto.c2g__Product__c}"/>
                    </apex:column>
                    <apex:column >
                        <apex:facet name="header">{!$ObjectType.product2.fields.ProductCode.label}</apex:facet>
                        <apex:outputText value="{!lineItem.ProductCode}"/>
                    </apex:column>

                    <apex:column rendered="{!!showLocalGLA && viewstate.EnableOverrideProductGLA}">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__GeneralLedgerAccount__c.label}</apex:facet>
                        <apex:outputField value="{!lineItem.dto.c2g__GeneralLedgerAccount__c}"/>
                    </apex:column>
                    
                    <apex:column rendered="{!showLocalGLA && viewstate.EnableOverrideProductGLA}">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__LocalGLA__c.label}</apex:facet>
                        <apex:outputField value="{!lineItem.dto.c2g__LocalGLA__c}"/>
                    </apex:column>

                    <apex:column styleClass="alignright widthsmall" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__Quantity__c.label}</apex:facet>
                        <apex:outputText value="{!lineItem.Quantity}"/>
                    </apex:column>
                    <apex:column styleClass="alignright widthmedium" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__UnitPrice__c.label}</apex:facet>
                        <apex:outputText value="{!lineItem.UnitPrice}" styleClass="alignright"/>
                    </apex:column>

                    <apex:column styleClass="widthauto" rendered="{!viewstate.isCombinedTax}">
                        <apex:facet name="header">
                            <apex:outputPanel layout="block">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxCodeCombined__c.label}</apex:outputPanel>
                        </apex:facet>
                        <apex:outputField id="taxCodeCombined" value="{!lineItem.dto.c2g__TaxCodeCombined__c}"/>
                    </apex:column>

                    <!-- Below column rendered depending on Tax Method -->

                    <apex:column styleClass="widthsmall alignright" headerClass="alignright" rendered="{!viewstate.useMultipleTaxCodes}">
                        <apex:facet name="header">{!$Label.c2g__codapageinvoiceviewtaxrate}</apex:facet>
                        <apex:outputPanel style="white-space: nowrap">
                            <apex:outputText value="{!lineItem.CompositeTaxRate}"/>
                            <c:AnalysisPopup tooltip="{!$Label.c2g__codapageinvoiceviewtoggletaxratesarea}">
                                <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceviewtaxrates}" collapsible="false" columns="1">
                                <apex:panelGrid columns="4" border="0" columnClasses="taxRatesLabel widthauto, widthauto, widthauto alignright, widthmedium alignright">
                                        <apex:outputText value=" "/>
                                        <apex:outputText value=" "/>
                                        <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewtaxrate2}" styleClass="taxRatesLabel"/>
                                        <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewtaxvalue}" styleClass="taxRatesLabel"/>

                                        <apex:outputLabel value="{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxCode1__c.label}"/>
                                        <apex:outputPanel styleClass="popupDataFieldOutput"><apex:outputField value="{!lineItem.dto.c2g__TaxCode1__c}"/></apex:outputPanel>
                                        <apex:outputPanel ><apex:outputText value="{!lineItem.TaxRate1FromLine}"/></apex:outputPanel>
                                        <apex:outputPanel ><apex:outputText value="{!lineItem.TaxValue1WithSymbol}"/></apex:outputPanel>

                                        <apex:outputLabel value="{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxCode2__c.label}"/>
                                        <apex:outputPanel styleClass="popupDataFieldOutput"><apex:outputField value="{!lineItem.dto.c2g__TaxCode2__c}"/></apex:outputPanel>
                                        <apex:outputPanel ><apex:outputText value="{!lineItem.TaxRate2FromLine}"/></apex:outputPanel>
                                        <apex:outputPanel ><apex:outputText value="{!lineItem.TaxValue2WithSymbol}"/></apex:outputPanel>

                                        <apex:outputLabel rendered="{!viewstate.isSalesAndUse}" value="{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxCode3__c.label}"/>
                                        <apex:outputPanel styleClass="popupDataFieldOutput" rendered="{!viewstate.isSalesAndUse}"><apex:outputField value="{!lineItem.dto.c2g__TaxCode3__c}"/></apex:outputPanel>
                                        <apex:outputPanel rendered="{!viewstate.isSalesAndUse}"><apex:outputText value="{!lineItem.TaxRate3FromLine}"/></apex:outputPanel>
                                        <apex:outputPanel rendered="{!viewstate.isSalesAndUse}"><apex:outputText value="{!lineItem.TaxValue3WithSymbol}"/></apex:outputPanel>
                                </apex:panelGrid>
                                </apex:pageBlockSection>
                            </c:AnalysisPopup>
                        </apex:outputPanel>
                    </apex:column>


                    <apex:column rendered="{!viewstate.isVAT}">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxCode1__c.label}</apex:facet>
                        <apex:outputField value="{!lineItem.dto.c2g__TaxCode1__c}"/>
                    </apex:column>
                    <apex:column styleClass="alignright widthmedium" rendered="{!viewstate.isVAT}" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxValue1__c.label}</apex:facet>
                        <apex:outputText value="{!lineItem.TaxValue1}" styleClass="alignright"/>
                    </apex:column>
                    <apex:column styleClass="widthmedium alignright" rendered="{!viewstate.useMultipleTaxCodes}" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxValue1__c.label}</apex:facet>
                        <apex:outputText id="taxValueSUT" value="{!lineItem.TaxValueTotalWithSymbol}" styleClass="alignright" />
                    </apex:column>
                    <apex:column styleClass="alignright widthmedium" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__NetValue__c.label}</apex:facet>
                        <apex:outputText id="netValue" value="{!lineItem.NetValue}"/>
                    </apex:column>
                    <apex:column styleClass="widthmedium alignright" headerClass="alignleft">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__IncomeSchedule__c.label}</apex:facet>
                        <apex:outputField id="incomeSchedule" value="{!lineItem.dto.c2g__IncomeSchedule__c}"/>
                    </apex:column>
                    <apex:column styleClass="widthsmall aligncenter" headerClass="alignright">
                        <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__IncomeScheduleGroup__c.label}</apex:facet>
                        <apex:outputField id="incomeScheduleGroup" value="{!lineItem.dto.c2g__IncomeScheduleGroup__c}" rendered="{!lineItem.ScheduleInformationButtonStatus}"/>
                    </apex:column>
                    <apex:column styleClass="widthicon alignright">
                        <apex:facet name="header">&nbsp;</apex:facet>
                        <apex:commandButton id="incomeScheduleButton" title="{!$Label.c2g__codainvoiceincomeschedulescheduleinformationview}" image="{!URLFOR($Resource.c2g__coda2go, 'coda2go/web/images/FinancialForceScheduleInformationIcon.png')}" action="{!lineItem.scheduleInformationOnView}" rendered="{!lineItem.ScheduleInformationButtonStatus}" styleClass="incomeScheduleButton"/>
                    </apex:column>
                </apex:pageBlockTable>
            </apex:pageBlockSection>
            <!-- Summary -->
            <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceviewsummary}" columns="2" collapsible="false">
                <!-- Tax Summary -->
                <apex:outputPanel layout="block" styleclass="taxsummaryarea">
                <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceviewtaxsummary}" columns="1">
                    <apex:pageBlockTable id="dtTaxSummary" value="{!viewstate.invoice.taxSummaryItems}" var="taxSummary">
                        <apex:column styleClass="widthmed">
                            <apex:facet name="header">
                                <apex:outputPanel layout="block">{!viewstate.invoice.TaxSummaryTaxCodeHeading}</apex:outputPanel>
                            </apex:facet>
                            <apex:outputText value="{!taxSummary.TaxCode}"/>
                        </apex:column>

                        <!-- Below column rendered depending on Tax Method -->
                        <apex:column styleClass="widthmed alignright" rendered="{!viewstate.showFullTaxSummary}">
                            <apex:facet name="header">
                                <apex:outputPanel layout="block">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxRate1__c.label}</apex:outputPanel>
                            </apex:facet>
                            <apex:outputText value="{!taxSummary.TaxRate}"/>
                        </apex:column>

                        <apex:column styleClass="widthmed alignright" headerClass="alignright" rendered="{!viewstate.isVat}">
                            <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__NetValue__c.label}</apex:facet>
                            <apex:outputText value="{!taxSummary.NetValue}"/>
                        </apex:column>
                        <apex:column styleClass="widthmed alignright" headerClass="alignright">
                            <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceLineItem__c.fields.c2g__TaxValue1__c.label}</apex:facet>
                            <apex:outputText value="{!taxSummary.TaxValue}"/>
                        </apex:column>
                    </apex:pageBlockTable>

                </apex:pageBlockSection>
                </apex:outputPanel>

                <apex:panelGrid columns="2" border="0" width="100%" styleClass="detailList" columnClasses="labelCol widthauto,dataCol alignright widthmedium">
                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__NetTotal__c.label}"/>
                    <apex:outputText id="netTotal" value="{!viewstate.invoice.NetTotal}"/>
                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__TaxTotal__c.label}"/>
                    <apex:outputText id="taxTotal" value="{!viewstate.invoice.TaxTotal}"/>
                    <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__InvoiceTotal__c.label}"/>
                    <apex:outputText id="invTotal" value="{!viewstate.invoice.InvoiceTotal}"/>
                </apex:panelGrid>
            </apex:pageBlockSection>

            <!-- Payment Schedule -->
            <apex:outputPanel id="paymentScheduleOutputPanel">
                <apex:pageBlockSection id="paymentSchedulePageBlockSection" title="{!$Label.c2g__codapageinvoiceviewpaymentschedule}" collapsible="true" columns="2">
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__PaymentSchedule__c.label}" for="paymentSchedule"/>
                        <apex:outputPanel layout="block" id="scheduleTypeOutputPanel">
                            <apex:outputField id="paymentSchedule" value="{!viewstate.invoice.dto.c2g__PaymentSchedule__c}"/>
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem ><apex:outputText /><apex:outputText /></apex:pageBlockSectionItem> <!-- empty outputtexts are needed to create borders-->
                    <apex:outputField id="numberOfPayments" value="{!viewstate.invoice.dto.c2g__NumberOfPayments__c}" styleClass="widthsmall alignright" rendered="{!viewstate.showPaymentSchedule}"/> 
                    <apex:outputField id="firstDueDate" value="{!viewstate.invoice.dto.c2g__FirstDueDate__c}" rendered="{!viewstate.showPaymentSchedule}"/>
                    <apex:outputField id="interval" value="{!viewstate.invoice.dto.c2g__Interval__c}" rendered="{!viewstate.showPaymentSchedule}"/>                   
                    <apex:outputText rendered="{!viewstate.showPaymentSchedule}"/>
                    <apex:pageBlockTable id="dtPaymentSchedule" value="{!viewstate.invoice.installmentLineItems}" var="installmentLineItem" rendered="{!viewstate.showPaymentSchedule}">
                        <apex:column styleClass="widthlinenumbers">
                            <apex:facet name="header">&nbsp;</apex:facet>
                            <apex:outputField id="lineNumber" value="{!installmentLineItem.dto.c2g__LineNumber__c}"/>
                        </apex:column>
                        <apex:column styleClass="widthauto">
                            <apex:facet name="header">
                                <apex:outputPanel layout="block">{!$ObjectType.c2g__codaInvoiceInstallmentLineItem__c.fields.c2g__DueDate__c.label}</apex:outputPanel>
                            </apex:facet>
                            <apex:outputField id="dueDate" value="{!installmentLineItem.dto.c2g__DueDate__c}"/>
                        </apex:column>
                        <apex:column styleClass="alignright widthmedium" headerClass="alignright">
                            <apex:facet name="header">{!$ObjectType.c2g__codaInvoiceInstallmentLineItem__c.fields.c2g__Amount__c.label}</apex:facet>
                            <apex:outputText id="amount" value="{!installmentLineItem.AmountWithSymbol}" styleClass="alignright"/>
                        </apex:column>
                    </apex:pageBlockTable>
                </apex:pageBlockSection>
            </apex:outputPanel>

            <!-- Income Schedule -->
            <apex:outputPanel id="incomeScheduleOutputPanel">
                <apex:pageBlockSection id="incomeSchedulePageBlockSection" title="{!$Label.c2g__codaincomeschedule}" rendered="{!!viewstate.showSchedule}" collapsible="true" columns="2">
                    <apex:pageBlockSectionItem >
                        <apex:outputText value="{!$Label.c2g__codaincomeschedule}"/>
                        <apex:outputPanel layout="block" id="incomeScheduleOutputblock">
                            <apex:outputField id="incomeSchedule" value="{!viewstate.invoice.dto.c2g__IncomeSchedule__c}" />
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem rendered="{!viewstate.showIncomeSchedule}">
                        <apex:outputText value="{!$Label.c2g__codaincomescheduleinvoicenettotal}"/>
                        <apex:outputPanel id="netTotal" styleClass="largeValue">
                            {!viewstate.currencySymbol}<apex:outputText value="{!viewstate.invoice.incomeScheduleNetTotalAsString}" styleClass="largeValue"/>
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem rendered="{!viewstate.showIncomeSchedule}">
                        <apex:outputLabel value="{!$Label.c2g__codaincomeschedulenumberofjournal}"/>
                        <apex:outputPanel >
                            <apex:outputField id="numberOfJournals" value="{!viewstate.invoice.dto.c2g__NumberofJournals__c}" />
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem rendered="{!viewstate.showIncomeSchedule}">
                        <apex:outputLabel value="{!$Label.c2g__codaincomeschedulestartdate}" />
                        <apex:outputPanel >
                            <apex:outputField value="{!viewstate.invoice.dto.c2g__StartDate__c}"/>
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem rendered="{!viewstate.showIncomeSchedule}">
                        <apex:outputLabel value="{!$Label.c2g__codaincomescheduleperiodintervals}" for="interval"/>
                        <apex:outputPanel >
                            <apex:outputField id="periodInterval" value="{!viewstate.invoice.dto.c2g__PeriodInterval__c}" />
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem rendered="{!viewstate.showIncomeSchedule}">
                        <apex:outputLabel value="{!$Label.c2g__codaincomescheduleusepartperiods}" for="interval"/>
                        <apex:outputPanel >
                            <apex:outputField id="partPeriods" value="{!viewstate.invoice.dto.c2g__Usepartperiods__c}"/>
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem rendered="{!viewstate.showIncomeSchedule}">
                        <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__IncomeScheduleGroup__c.label}" />
                        <apex:outputField id="incScheduleGroup" value="{!viewstate.invoice.dto.c2g__IncomeScheduleGroup__c}"/>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem />

                    <apex:pageBlockTable id="dtPaymentSchedule" value="{!viewstate.invoice.scheduleLineItems}" var="scheduleLineItem" rendered="{!viewstate.showIncomeSchedule}">

                        <apex:column styleClass="widthauto" headerClass="widthauto" footerClass="alignright pageBlockTableNoLabelFooter">
                            <apex:facet name="header">
                                {!$Label.c2g__codaincomescheduleyearperiod}
                            </apex:facet>
                            <apex:facet name="footer">
                                <apex:outputText value="{!$Label.c2g__codaincomescheduleincomescheduletotal}"/>
                            </apex:facet>
                            <apex:outputText id="period" value="{!scheduleLineItem.yearPeriod}"/>
                        </apex:column>

                        <apex:column styleClass="widthlarge alignright" headerClass="widthlarge alignright" footerClass="widthlarge alignright pageBlockTableNoLabelFooter">
                            <apex:facet name="header">
                                {!$Label.c2g__codaincomescheduleamount}
                            </apex:facet>
                            <apex:facet name="footer">
                                <apex:outputPanel styleClass="largeValue">
                                    {!viewstate.currencySymbol}<apex:outputText id="scheduleTotal" value="{!viewstate.invoice.incomeScheduleTotalAsString}" />
                                </apex:outputPanel>
                            </apex:facet>
                            <apex:outputField id="amount" value="{!scheduleLineItem.dto.c2g__Amount__c}"/>
                        </apex:column>

                    </apex:pageBlockTable>

                </apex:pageBlockSection>
            </apex:outputPanel>

            <!-- Invoice Status -->
            <apex:pageBlockSection title="{!$Label.c2g__codapageinvoiceviewinvoicestatus}">
                <apex:outputField value="{!viewstate.invoice.dto.c2g__InvoiceStatus__c}"/>
                <apex:outputField value="{!viewstate.invoice.dto.c2g__DiscardReason__c}"/>
                <apex:outputField value="{!viewstate.invoice.invoice.Transaction.dto.c2g__MatchType__c}" rendered="{!!isblank(viewstate.invoice.invoice.Transaction.dto.c2g__MatchType__c)}"/>
            </apex:pageBlockSection>

            <c:MatchedPayments payments="{!payments}"/>

            <!-- Starting Edit  -->
            <apex:pageBlockSection columns="1" title="{!$Label.c2g__codapageinvoicenewprintedtext}" id="printedTextBlock">

                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText1Panel}">
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewtextdef1}"/>
                    <apex:outputText id="textDefName1" value="{!viewState.invoice.dto.c2g__PrintedText1TextDefinitionName__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText1Panel}">
                    <apex:outputLabel id="heading1Label" value="{!$Label.c2g__codapageinvoiceviewheading}" style="{!viewState.invoice.DisabledPrintedText1Style}"/>
                    <apex:outputText id="heading1" value="{!viewstate.invoice.dto.c2g__PrintedText1Heading__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText1Panel}">
                    <apex:outputLabel id="text1Label" value="{!$Label.c2g__codapageinvoiceviewtext}" style="{!viewState.invoice.DisabledPrintedText1Style}"/>
                    <apex:repeat value="{!viewstate.invoice.textdefvalue1}" var="textvalue1">
                        <apex:outputText value="{!textvalue1}"/><br/>
                    </apex:repeat>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText2Panel}">
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewtextdef2}"/>
                    <apex:outputText id="textDefName2" value="{!viewState.invoice.dto.c2g__PrintedText2TextDefinitionName__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText2Panel}">
                    <apex:outputLabel id="heading2Label" value="{!$Label.c2g__codapageinvoiceviewheading}" style="{!viewState.invoice.DisabledPrintedText1Style}"/>
                    <apex:outputText id="heading2" value="{!viewstate.invoice.dto.c2g__PrintedText2Heading__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText2Panel}">
                    <apex:outputLabel id="text2Label" value="{!$Label.c2g__codapageinvoiceviewtext}" style="{!viewState.invoice.DisabledPrintedText1Style}"/>
                    <apex:repeat value="{!viewstate.invoice.textdefvalue2}" var="textvalue2">
                        <apex:outputText value="{!textvalue2}"/><br/>
                    </apex:repeat>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText3Panel}">
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewtextdef3}"/>
                    <apex:outputText id="textDefName3" value="{!viewState.invoice.dto.c2g__PrintedText3TextDefinitionName__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText3Panel}">
                    <apex:outputLabel id="heading3Label" value="{!$Label.c2g__codapageinvoiceviewheading}" style="{!viewState.invoice.DisabledPrintedText1Style}"/>
                    <apex:outputText id="heading3" value="{!viewstate.invoice.dto.c2g__PrintedText3Heading__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText3Panel}">
                    <apex:outputLabel id="text3Label" value="{!$Label.c2g__codapageinvoiceviewtext}" style="{!viewState.invoice.DisabledPrintedText1Style}"/>
                    <apex:repeat value="{!viewstate.invoice.textdefvalue3}" var="textvalue3">
                        <apex:outputText value="{!textvalue3}"/><br/>
                    </apex:repeat>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText4Panel}">
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewtextdef4}"/>
                    <apex:outputText id="textDefName4" value="{!viewState.invoice.dto.c2g__PrintedText4TextDefinitionName__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText4Panel}">
                    <apex:outputLabel id="heading4Label" value="{!$Label.c2g__codapageinvoiceviewheading}" style="{!viewState.invoice.DisabledPrintedText1Style}"/>
                    <apex:outputText id="heading4" value="{!viewstate.invoice.dto.c2g__PrintedText4Heading__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText4Panel}">
                    <apex:outputLabel id="text4Label" value="{!$Label.c2g__codapageinvoiceviewtext}" style="{!viewState.invoice.DisabledPrintedText1Style}"/>
                    <apex:repeat value="{!viewstate.invoice.textdefvalue4}" var="textvalue4">
                        <apex:outputText value="{!textvalue4}"/><br/>
                    </apex:repeat>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText5Panel}">
                    <apex:outputLabel value="{!$Label.c2g__codapageinvoiceviewtextdef5}"/>
                    <apex:outputText id="textDefName5" value="{!viewState.invoice.dto.c2g__PrintedText5TextDefinitionName__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText5Panel}">
                    <apex:outputLabel id="heading1Labe5" value="{!$Label.c2g__codapageinvoiceviewheading}" style="{!viewState.invoice.DisabledPrintedText1Style}"/>
                    <apex:outputText id="heading5" value="{!viewstate.invoice.dto.c2g__PrintedText5Heading__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!viewstate.invoice.showPrintedText5Panel}">
                    <apex:outputLabel id="text5Label" value="{!$Label.c2g__codapageinvoiceviewtext}" style="{!viewState.invoice.DisabledPrintedText1Style}"/>
                    <apex:repeat value="{!viewstate.invoice.textdefvalue5}" var="textvalue5">
                        <apex:outputText value="{!textvalue5}"/><br/>
                    </apex:repeat>
                </apex:pageBlockSectionItem>


            </apex:pageBlockSection>
            <!-- Ending Edit  -->
            <script>
                CODA.twistPageBlockSection("{!$Component.printedTextBlock}");
            </script>
        </apex:pageBlock>
        <script>
            CODA.setExpanderIconState('view');
        </script>
    </apex:form>

    <!-- Notes and Attachments, Open Activities, Activity Histories -->
    <apex:relatedList list="CombinedAttachments"/>
    <apex:relatedList list="OpenActivities"/>
    <apex:relatedList list="ActivityHistories"/>
    <!-- Payment Details -->
    <apex:form onsubmit="if(CODA2GoButtons.disableSaveButtons){ return CODA2GoButtons.disableSaveButtons(); }">
    <apex:pageBlock title="{!$Label.c2g__codapageinvoiceviewpaymentdetails}">
       <apex:pageBlockSection >
       <apex:pageBlockSectionItem >
            <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__PaymentStatus__c.label}"/>
            <apex:outputText value="{!viewstate.invoice.PaymentStatus}"/>
         </apex:pageBlockSectionItem>
         <apex:pageBlockSectionItem >
           <apex:outputLabel value="{!$ObjectType.c2g__codaInvoice__c.fields.c2g__OutstandingValue__c.label}"/>
            <apex:outputField value="{!viewstate.invoice.dto.c2g__OutstandingValue__c}" styleClass="alignright"/>
       </apex:pageBlockSectionItem>
         </apex:pageBlockSection>
        </apex:pageBlock>
        <script>
            CODA.setExpanderIconState('view');
        </script>
     </apex:form>

    <!-- Print Log -->
    <!-- apex:relatedList list="PrintLogs__r" rendered="{!viewstate.invoice.showPrintLog}"/-->
        <!-- Event Log -->
    <apex:relatedList id="eventLogs" list="EventLogs__r" rendered="{!viewstate.invoice.showEventLog}"/>
    <apex:outputPanel id="jsCompanyMode">
        <script>
            var isValidCompany = {!ValidCompany}; 
        </script>
    </apex:outputPanel>

    <script>

        /**
        * Check whether the user has access to read integration rules.  If not they cannot view the pdf.
        * @param {String} targetUrl The url to direct the user to if they have sufficient access rights.
        */
        function integrationRuleCheck(targetUrl)
        {
            var canAccessIntegrationRules = {!viewstate.canAccessIntegrationRules};
            if(CODA2GoButtons){
                CODA2GoButtons.enableSaveButtons();
            }
            if (canAccessIntegrationRules)
            {
                window.open(targetUrl);
            } 
            else if(!canAccessIntegrationRules)
            {
                alert('{!$ObjectType.codaIntegrationRule__c.Label}: {!$Label.codaMessageNoPermissionToAccess}'); 
            }
        }

        function integrationRuleCheckWithButton(button)
        {
			if ({!viewstate.canAccessIntegrationRules}) 
            {
                document.getElementById(button).click();
            } 
            else 
            {
                alert('{!$ObjectType.codaIntegrationRule__c.Label}: {!$Label.codaMessageNoPermissionToAccess}'); 
            }
            return false;
        }
    </script>    
</apex:page>